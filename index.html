<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Time Allocation Planning Model</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            max-width: 1200px; 
            background: #f5f5f5;
        }
        
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tabs { 
            display: flex; 
            margin-bottom: 20px; 
            border-bottom: 2px solid #007cba;
        }
        
        .tab { 
            padding: 12px 24px; 
            background: #f0f0f0; 
            border: none; 
            cursor: pointer; 
            margin-right: 2px; 
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .tab:hover { 
            background: #e0e0e0; 
        }
        
        .tab.active { 
            background: #007cba; 
            color: white; 
        }
        
        .tab-content { 
            display: none; 
        }
        
        .tab-content.active { 
            display: block; 
        }
        
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            background: #f9f9f9; 
            border-left: 4px solid #007cba; 
            border-radius: 4px;
        }
        
        .input-group { 
            display: flex; 
            align-items: center; 
            margin: 10px 0; 
            flex-wrap: wrap;
        }
        
        .input-group label { 
            width: 300px; 
            font-weight: 500;
        }
        
        .input-group input, .input-group select { 
            width: 100px; 
            margin: 0 10px; 
            padding: 8px; 
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .result { 
            background: #e8f5e8; 
            padding: 5px 10px; 
            border-radius: 4px; 
            font-weight: bold; 
            color: #2d5a2d;
        }
        
        .warning { 
            background: #fff3cd; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            border: 1px solid #ffeaa7;
        }
        
        .alert { 
            background: #f8d7da; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            border: 1px solid #f5c6cb;
        }
        
        .summary { 
            background: #d4edda; 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 4px; 
            border: 1px solid #c3e6cb;
        }
        
        .indicator { 
            padding: 3px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
            margin-left: 10px; 
            font-weight: bold;
        }
        
        .individual { background: #4ecdc4; color: white; }
        .leader { background: #9b59b6; color: white; }
        .embedded { background: #ff6b6b; color: white; }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 10px 0; 
        }
        
        th, td { 
            padding: 12px; 
            border: 1px solid #ddd; 
            text-align: left; 
        }
        
        th { 
            background: #f8f9fa; 
            font-weight: bold;
        }
        
        .export-section { 
            background: #e7f3ff; 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 5px; 
            border: 1px solid #007cba; 
        }
        
        .export-btn { 
            background: #007cba; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
            font-weight: bold;
            transition: background 0.3s ease;
        }
        
        .export-btn:hover { 
            background: #005a8b; 
        }
        
        .small-input { 
            width: 60px !important; 
        }
        
        h1 {
            color: #007cba;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h3 {
            color: #333;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Enhanced Time Allocation Planning Model</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('instructions')">Instructions & Guidelines</button>
            <button class="tab" onclick="showTab('basic')">Basic Planning</button>
            <button class="tab" onclick="showTab('budget')">Budget Planning</button>
        </div>

        <!-- Instructions Tab -->
        <div id="instructions" class="tab-content active">
            <div class="section">
                <h3>How to Use This Tool</h3>
                <p><strong>This planning model helps managers allocate employee time between billable and non-billable activities for AOP planning.</strong></p>
                
                <h4>Step-by-Step Instructions:</h4>
                <ol>
                    <li><strong>Start with Basic Planning:</strong> Select employee type and adjust utilization targets</li>
                    <li><strong>Create Budget:</strong> Use Budget Planning tab to translate into detailed BMO categories for AOP</li>
                    <li><strong>Export to CPM:</strong> Generate a CPM-compatible spreadsheet for direct import into company CRM system</li>
                    <li><strong>Adjust as Needed:</strong> Balance allocations to stay within available non-billable time</li>
                </ol>
                
                <h4>CPM Export Features:</h4>
                <ul>
                    <li><strong>Direct CRM Integration:</strong> Export creates spreadsheet in exact CPM format required by company systems</li>
                    <li><strong>Monthly Distribution:</strong> Hours are automatically distributed across 2026 months based on work day percentages</li>
                    <li><strong>Strategic Categorization:</strong> Budget categories roll up into four key CPM buckets for streamlined reporting</li>
                    <li><strong>Annual Planning:</strong> Supports full fiscal year 2026 budgeting with monthly breakdowns</li>
                </ul>
            </div>

            <div class="section">
                <h3>Leadership Accountability Framework</h3>
                <p><strong>People Leaders managing billable employees have a fiduciary responsibility to proactively engage in strategic workforce planning conversations.</strong> This includes conducting structured discussions with team members to identify individual professional development priorities, align personal growth objectives with organizational strategic initiatives, and optimize non-billable time allocation to maximize both employee engagement and business value creation.</p>
            </div>
            
            <div class="section">
                <h3>Strategic Allocation Guidelines for Non-Billable Time</h3>
                <p>To ensure optimal return on human capital investment, managers should implement the following strategic allocation framework for available non-billable hours:</p>
                <ol>
                    <li><strong>25% Optional Training/Development Opportunities</strong> - Builds future capability pipeline and maintains competitive skill sets</li>
                    <li><strong>30% Culture & Employee Experience Activities</strong> - Drives engagement metrics, retention rates, and organizational culture strength</li>
                    <li><strong>45% Business-Related Activities</strong> - Ensures operational excellence and strategic alignment</li>
                </ol>
                <p><em>Note: These percentages should be applied to discretionary time after accounting for mandatory requirements (PTO, holidays, required training, administrative duties).</em></p>
                
                <h4>Cultural Leadership Allocation:</h4>
                <p>For employees interested in cultural leadership roles (Culture Committee or Employee Resource Groups), allocate:</p>
                <ul>
                    <li><strong>60 hours annually</strong> under Culture & Employee Experience (5 hours per month)</li>
                    <li><strong>16 hours annually</strong> for Leadership Development</li>
                    <li><strong>6 hours annually</strong> for additional travel</li>
                </ul>
            </div>

            <div class="section">
                <h3>CPM Export Categories</h3>
                <p><strong>The tool automatically maps your detailed budget planning into four key CPM categories:</strong></p>
                <table>
                    <tr>
                        <th>CPM Category</th>
                        <th>Source Categories</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Direct Override</strong></td>
                        <td>All billable hours</td>
                        <td>Client-facing project work and direct revenue activities</td>
                    </tr>
                    <tr>
                        <td><strong>Bold Step Hours</strong></td>
                        <td>Strategy / Innovation</td>
                        <td>Strategic initiatives, innovation projects, and digital transformation</td>
                    </tr>
                    <tr>
                        <td><strong>PTO Usage Override</strong></td>
                        <td>PTO categories only</td>
                        <td>Personal time off, sick leave, parental leave (excludes company holidays)</td>
                    </tr>
                    <tr>
                        <td><strong>All Other Indirect Override</strong></td>
                        <td>All remaining categories</td>
                        <td>Training, administrative, culture, business activities, holidays</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h3>Employee Type Comparison</h3>
                <table>
                    <tr>
                        <th>Employee Type</th>
                        <th>Target Util%</th>
                        <th>Reality Util%</th>
                        <th>Non-Bill Available</th>
                        <th>Strategic Time</th>
                    </tr>
                    <tr>
                        <td>Individual Contributor</td>
                        <td>80%</td>
                        <td>85%</td>
                        <td>416 hrs</td>
                        <td>90 hrs</td>
                    </tr>
                    <tr>
                        <td>People Leader</td>
                        <td>50%</td>
                        <td>55%</td>
                        <td>1040 hrs</td>
                        <td>280 hrs</td>
                    </tr>
                    <tr>
                        <td>Embedded Employee</td>
                        <td>95%</td>
                        <td>100%</td>
                        <td>104 hrs</td>
                        <td>20 hrs</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Basic Planning Tab -->
        <div id="basic" class="tab-content">
            <div class="section">
                <h3>Employee Configuration</h3>
                <div class="input-group">
                    <label>Employee Name:</label>
                    <input type="text" id="employeeName" placeholder="Enter employee name" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label>Employee Type:</label>
                    <select id="employeeType" onchange="updateEmployeeType()">
                        <option value="individual">Individual Contributor</option>
                        <option value="leader">People Leader</option>
                        <option value="embedded">Embedded (Client Site)</option>
                    </select>
                    <span id="typeDisplay" class="indicator individual">Individual Contributor</span>
                </div>
                <div class="input-group">
                    <label>Life Line Sector (LLS):</label>
                    <select id="lls">
                        <option value="power">Power</option>
                        <option value="renewables">Renewables</option>
                        <option value="transportation">Transportation</option>
                        <option value="water">Water</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Total Hours/Year:</label>
                    <input type="number" id="totalHours" value="2080" onchange="calculateAll()">
                    <span class="result" id="totalHoursResult">2,080</span>
                </div>
                <div class="input-group">
                    <label>Target Utilization %:</label>
                    <input type="number" id="utilization" value="80" onchange="calculateAll()">
                    <span class="result" id="utilizationResult">80%</span>
                </div>
            </div>

            <div class="section">
                <h3>Billable vs Non-Billable Breakdown</h3>
                <div class="input-group">
                    <label>Billable Hours (Target):</label>
                    <span class="result" id="billableResult">1,664</span>
                </div>
                <div class="input-group">
                    <label>Available Non-Billable Hours:</label>
                    <span class="result" id="nonBillableResult">416</span>
                </div>
                <div class="input-group">
                    <label>Actual Utilization % (Reality Check):</label>
                    <input type="number" id="actualUtilization" value="85" onchange="calculateAll()">
                    <span class="result" id="actualUtilizationResult">85%</span>
                </div>
                <div id="utilizationWarning" class="warning" style="display:none;"></div>
            </div>

            <div class="section">
                <h3>Essential Non-Billable Categories</h3>
                <div class="input-group">
                    <label>PTO (Personal/Sick Time, parental, medical, bereavement, jury duty):</label>
                    <input type="number" id="pto" value="120" onchange="calculateAll()">
                    <span class="result" id="ptoResult">120</span>
                </div>
                <div class="input-group">
                    <label>Holiday Hours (company holidays):</label>
                    <input type="number" id="holidays" value="64" onchange="calculateAll()">
                    <span class="result" id="holidaysResult">64</span>
                </div>
                <div class="input-group">
                    <label>Travel Time (conferences, training, client meetings):</label>
                    <input type="number" id="travel" value="20" onchange="calculateAll()">
                    <span class="result" id="travelResult">20</span>
                </div>
                <div class="input-group">
                    <label>Required Business Training (compliance, platforms, competencies):</label>
                    <input type="number" id="businessTraining" value="13" onchange="calculateAll()">
                    <span class="result" id="businessTrainingResult">13</span>
                </div>
                <div class="input-group">
                    <label>Technical Training (certifications, upskilling, reskilling):</label>
                    <input type="number" id="techTraining" value="30" onchange="calculateAll()">
                    <span class="result" id="techTrainingResult">30</span>
                </div>
                <div class="input-group">
                    <label>Hiring Activities (interviewing, prep, recruiting):</label>
                    <input type="number" id="hiring" value="20" onchange="calculateAll()">
                    <span class="result" id="hiringResult">20</span>
                </div>
                <div class="input-group">
                    <label>Administrative (reviews, reporting, Glint surveys):</label>
                    <input type="number" id="admin" value="60" onchange="calculateAll()">
                    <span class="result" id="adminResult">60</span>
                </div>
            </div>

            <div class="section">
                <h3>Strategic & Development Activities</h3>
                <div class="input-group">
                    <label>Strategy / Innovation:</label>
                    <input type="number" id="innovation" value="10" onchange="calculateAll()">
                    <span class="result" id="innovationResult">10</span>
                </div>
                <div class="input-group">
                    <label>Culture & Employee Experience (ERGs, wellbeing, connectivity):</label>
                    <input type="number" id="culture" value="13" onchange="calculateAll()">
                    <span class="result" id="cultureResult">13</span>
                </div>
                <div class="input-group">
                    <label>Volunteer Hours (8 hours annually per employee):</label>
                    <input type="number" id="volunteer" value="8" onchange="calculateAll()">
                    <span class="result" id="volunteerResult">8</span>
                </div>
                <div class="input-group">
                    <label>Optional Professional Development (conferences, external training):</label>
                    <input type="number" id="optionalDev" value="17" onchange="calculateAll()">
                    <span class="result" id="optionalDevResult">17</span>
                </div>
                <div class="input-group">
                    <label>Business Activities (team meetings, town halls, check-ins):</label>
                    <input type="number" id="businessActivities" value="31" onchange="calculateAll()">
                    <span class="result" id="businessActivitiesResult">31</span>
                </div>
            </div>

            <div class="section">
                <h3>Summary</h3>
                <div class="input-group">
                    <label>Total Allocated Non-Billable Hours:</label>
                    <span class="result" id="totalAllocated">406</span>
                </div>
                <div class="input-group">
                    <label>Buffer Time:</label>
                    <span class="result" id="bufferTime">10</span>
                </div>
                <div id="statusMessage" class="summary">Status: Within limits</div>
            </div>

            <div class="export-section">
                <h3>Export & Replication</h3>
                <p><strong>Use these options to save and replicate planning for your team members:</strong></p>
                <button class="export-btn" onclick="exportToCPM()">Export CPM Spreadsheet</button>
                <button class="export-btn" onclick="exportToCSV()">Download as CSV</button>
                <button class="export-btn" onclick="printReport()">Print/PDF Report</button>
                <button class="export-btn" onclick="resetForm()">Clear for Next Employee</button>
                <p><em>Use CPM Export for direct import into company CRM system. Save each team member's allocation separately for comprehensive AOP planning.</em></p>
            </div>
        </div>

        <!-- Budget Planning Tab -->
        <div id="budget" class="tab-content">
            <div class="section">
                <h3>Complete Budget Planning (BMO Category Breakdown)</h3>
                <p>This tool breaks down your basic planning into detailed BMO budget categories for AOP planning:</p>
                
                <div class="input-group">
                    <label>Employee Name:</label>
                    <div class="result" id="budgetEmployeeName">Enter name in Basic Planning</div>
                </div>
                <div class="input-group">
                    <label>Total Available Non-Billable Hours:</label>
                    <div class="result" id="budgetTotal">416 hours</div>
                </div>
                <div class="input-group">
                    <label>Strategic Time Available (after essentials):</label>
                    <div class="result" id="budgetStrategic">90 hours</div>
                </div>
            </div>

            <div class="section">
                <h3>PTO (Personal/Sick Time)</h3>
                <div class="input-group">
                    <label>PTO - Personal/Sick Time:</label>
                    <input type="number" id="budgetPTO" value="120" onchange="calculateBudget()">
                    <span class="result" id="budgetPTOResult">120</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetPTOOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetPTOOtherDesc" placeholder="Describe other PTO" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total PTO:</strong></label>
                    <span class="result" id="budgetPTOTotal">120</span>
                </div>
            </div>

            <div class="section">
                <h3>Holiday Hours</h3>
                <div class="input-group">
                    <label>Company Holidays:</label>
                    <input type="number" id="budgetHolidays" value="64" onchange="calculateBudget()">
                    <span class="result" id="budgetHolidaysResult">64</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetHolidaysOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetHolidaysOtherDesc" placeholder="Describe other holidays" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Holiday Hours:</strong></label>
                    <span class="result" id="budgetHolidaysTotal">64</span>
                </div>
            </div>

            <div class="section">
                <h3>Travel Time</h3>
                <div class="input-group">
                    <label>Conference Travel:</label>
                    <input type="number" id="budgetConferenceTravel" value="10" onchange="calculateBudget()">
                    <span class="result" id="budgetConferenceTravelResult">10</span>
                </div>
                <div class="input-group">
                    <label>Training Travel:</label>
                    <input type="number" id="budgetTrainingTravel" value="5" onchange="calculateBudget()">
                    <span class="result" id="budgetTrainingTravelResult">5</span>
                </div>
                <div class="input-group">
                    <label>Client Meeting Travel:</label>
                    <input type="number" id="budgetClientTravel" value="5" onchange="calculateBudget()">
                    <span class="result" id="budgetClientTravelResult">5</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetTravelOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetTravelOtherDesc" placeholder="Describe other travel" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Travel Time:</strong></label>
                    <span class="result" id="budgetTravelTotal">20</span>
                </div>
            </div>

            <div class="section">
                <h3>Required Business Training</h3>
                <div class="input-group">
                    <label>Compliance Training:</label>
                    <input type="number" id="budgetCompliance" value="4" onchange="calculateBudget()">
                    <span class="result" id="budgetComplianceResult">4</span>
                </div>
                <div class="input-group">
                    <label>Leadership Development:</label>
                    <input type="number" id="budgetLeadership" value="5" onchange="calculateBudget()">
                    <span class="result" id="budgetLeadershipResult">5</span>
                </div>
                <div class="input-group">
                    <label>Processes & Platforms Training:</label>
                    <input type="number" id="budgetPlatform" value="4" onchange="calculateBudget()">
                    <span class="result" id="budgetPlatformResult">4</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetBusinessTrainingOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetBusinessTrainingOtherDesc" placeholder="Describe other training" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Required Business Training:</strong></label>
                    <span class="result" id="budgetBusinessTrainingTotal">13</span>
                </div>
            </div>

            <div class="section">
                <h3>Technical Training</h3>
                <div class="input-group">
                    <label>Certifications:</label>
                    <input type="number" id="budgetCertifications" value="15" onchange="calculateBudget()">
                    <span class="result" id="budgetCertificationsResult">15</span>
                </div>
                <div class="input-group">
                    <label>Upskilling/Reskilling:</label>
                    <input type="number" id="budgetUpskilling" value="15" onchange="calculateBudget()">
                    <span class="result" id="budgetUpskillingResult">15</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetTechTrainingOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetTechTrainingOtherDesc" placeholder="Describe other technical training" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Technical Training:</strong></label>
                    <span class="result" id="budgetTechTrainingTotal">30</span>
                </div>
            </div>

            <div class="section">
                <h3>Hiring Activities</h3>
                <div class="input-group">
                    <label>Interviewing:</label>
                    <input type="number" id="budgetInterviewing" value="10" onchange="calculateBudget()">
                    <span class="result" id="budgetInterviewingResult">10</span>
                </div>
                <div class="input-group">
                    <label>Recruiting:</label>
                    <input type="number" id="budgetRecruiting" value="5" onchange="calculateBudget()">
                    <span class="result" id="budgetRecruitingResult">5</span>
                </div>
                <div class="input-group">
                    <label>Onboarding:</label>
                    <input type="number" id="budgetOnboarding" value="5" onchange="calculateBudget()">
                    <span class="result" id="budgetOnboardingResult">5</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetHiringOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetHiringOtherDesc" placeholder="Describe other hiring activities" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Hiring Activities:</strong></label>
                    <span class="result" id="budgetHiringTotal">20</span>
                </div>
            </div>

            <div class="section">
                <h3>Administrative</h3>
                <div class="input-group">
                    <label>Performance Reviews:</label>
                    <input type="number" id="budgetReviews" value="25" onchange="calculateBudget()">
                    <span class="result" id="budgetReviewsResult">25</span>
                </div>
                <div class="input-group">
                    <label>Indirect Reporting:</label>
                    <input type="number" id="budgetReporting" value="20" onchange="calculateBudget()">
                    <span class="result" id="budgetReportingResult">20</span>
                </div>
                <div class="input-group">
                    <label>Employee Surveys (Glint):</label>
                    <input type="number" id="budgetSurveys" value="15" onchange="calculateBudget()">
                    <span class="result" id="budgetSurveysResult">15</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetAdminOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetAdminOtherDesc" placeholder="Describe other administrative work" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Administrative:</strong></label>
                    <span class="result" id="budgetAdminTotal">60</span>
                </div>
            </div>

            <div class="section">
                <h3>Strategy / Innovation</h3>
                <div class="input-group">
                    <label>Innovation / Digital Transformation:</label>
                    <input type="number" id="budgetInnovationProjects" value="6" onchange="calculateBudget()">
                    <span class="result" id="budgetInnovationProjectsResult">6</span>
                </div>
                <div class="input-group">
                    <label>Other Strategic Plan:</label>
                    <input type="number" id="budgetDigitalTransform" value="4" onchange="calculateBudget()">
                    <span class="result" id="budgetDigitalTransformResult">4</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetInnovationOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetInnovationOtherDesc" placeholder="Describe other strategy work" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Strategy / Innovation:</strong></label>
                    <span class="result" id="budgetInnovationTotal">10</span>
                </div>
            </div>

            <div class="section">
                <h3>Culture & Employee Experience</h3>
                <div class="input-group">
                    <label>ERG Participation:</label>
                    <input type="number" id="budgetERG" value="8" onchange="calculateBudget()">
                    <span class="result" id="budgetERGResult">8</span>
                </div>
                <div class="input-group">
                    <label>Wellbeing Activities:</label>
                    <input type="number" id="budgetWellbeing" value="3" onchange="calculateBudget()">
                    <span class="result" id="budgetWellbeingResult">3</span>
                </div>
                <div class="input-group">
                    <label>Culture / Connectivity:</label>
                    <input type="number" id="budgetConnectivity" value="2" onchange="calculateBudget()">
                    <span class="result" id="budgetConnectivityResult">2</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetCultureOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetCultureOtherDesc" placeholder="Describe other culture activities" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Culture & Employee Experience:</strong></label>
                    <span class="result" id="budgetCultureTotal">13</span>
                </div>
            </div>

            <div class="section">
                <h3>Volunteer Hours</h3>
                <div class="input-group">
                    <label>Company Volunteer Time:</label>
                    <input type="number" id="budgetVolunteer" value="8" onchange="calculateBudget()">
                    <span class="result" id="budgetVolunteerResult">8</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetVolunteerOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetVolunteerOtherDesc" placeholder="Describe other volunteer work" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Volunteer Hours:</strong></label>
                    <span class="result" id="budgetVolunteerTotal">8</span>
                </div>
            </div>

            <div class="section">
                <h3>Optional Professional Development</h3>
                <div class="input-group">
                    <label>External Conferences:</label>
                    <input type="number" id="budgetExternalConf" value="12" onchange="calculateBudget()">
                    <span class="result" id="budgetExternalConfResult">12</span>
                </div>
                <div class="input-group">
                    <label>External Training:</label>
                    <input type="number" id="budgetExternalTraining" value="5" onchange="calculateBudget()">
                    <span class="result" id="budgetExternalTrainingResult">5</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetOptionalDevOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetOptionalDevOtherDesc" placeholder="Describe other professional development" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Optional Professional Development:</strong></label>
                    <span class="result" id="budgetOptionalDevTotal">17</span>
                </div>
            </div>

            <div class="section">
                <h3>Business Activities</h3>
                <div class="input-group">
                    <label>Team Meetings:</label>
                    <input type="number" id="budgetTeamMeetings" value="20" onchange="calculateBudget()">
                    <span class="result" id="budgetTeamMeetingsResult">20</span>
                </div>
                <div class="input-group">
                    <label>Town Halls:</label>
                    <input type="number" id="budgetTownHalls" value="6" onchange="calculateBudget()">
                    <span class="result" id="budgetTownHallsResult">6</span>
                </div>
                <div class="input-group">
                    <label>Check-ins:</label>
                    <input type="number" id="budgetCheckins" value="5" onchange="calculateBudget()">
                    <span class="result" id="budgetCheckinsResult">5</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetBusinessOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetBusinessOtherDesc" placeholder="Describe other business activities" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Business Activities:</strong></label>
                    <span class="result" id="budgetBusinessActivitiesTotal">31</span>
                </div>
            </div>

            <div class="summary">
                <h3>Complete Budget Summary</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>Total Essential Hours:</strong><br>
                        <span id="totalEssentialAllocated">327 hours</span>
                    </div>
                    <div>
                        <strong>Total Strategic Hours:</strong><br>
                        <span id="totalStrategicAllocated">89 hours</span>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <strong>Grand Total Allocated:</strong><br>
                        <span id="grandTotalAllocated">416 hours</span>
                    </div>
                    <div>
                        <strong>Budget Status:</strong><br>
                        <span id="budgetStatus" style="color: green;">Within range</span>
                    </div>
                </div>
                
                <div id="budgetAlert" class="alert" style="display: none;">
                    <strong>Budget Alert:</strong> Total allocation exceeds available time.
                </div>
            </div>

            <div class="export-section">
                <h3>Export Budget Planning</h3>
                <p><strong>Save your detailed budget breakdown:</strong></p>
                <button class="export-btn" onclick="exportBudgetToCPM()">Export Budget to CPM</button>
                <button class="export-btn" onclick="exportBudgetToCSV()">Download Budget as CSV</button>
                <button class="export-btn" onclick="printBudgetReport()">Print Budget Report</button>
                <button class="export-btn" onclick="resetBudgetForm()">Clear Budget for Next Employee</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        var currentTab = 'instructions';
        
        // Monthly work hours for 2026 with percentages
        var months2026 = [
            { name: 'Jan-2026', hours: 176, percentage: 8.66 },
            { name: 'Feb-2026', hours: 160, percentage: 7.87 },
            { name: 'Mar-2026', hours: 168, percentage: 8.27 },
            { name: 'Apr-2026', hours: 176, percentage: 8.66 },
            { name: 'May-2026', hours: 160, percentage: 7.87 },
            { name: 'Jun-2026', hours: 176, percentage: 8.66 },
            { name: 'Jul-2026', hours: 168, percentage: 8.27 },
            { name: 'Aug-2026', hours: 168, percentage: 8.27 },
            { name: 'Sep-2026', hours: 168, percentage: 8.27 },
            { name: 'Oct-2026', hours: 176, percentage: 8.66 },
            { name: 'Nov-2026', hours: 160, percentage: 7.87 },
            { name: 'Dec-2026', hours: 176, percentage: 8.66 }
        ];
        
        // Tab switching function
        function showTab(tabName) {
            // Hide all tab contents
            var tabContents = document.getElementsByClassName('tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Remove active class from all tabs
            var tabs = document.getElementsByClassName('tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Show the selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update current tab
            currentTab = tabName;
            
            // Sync data when switching to budget tab
            if (tabName === 'budget') {
                syncBasicToBudget();
            }
        }

        // Helper functions for safe DOM manipulation
        function getValue(id, defaultValue) {
            var element = document.getElementById(id);
            if (element && element.value !== undefined && element.value !== '') {
                var value = parseFloat(element.value);
                return isNaN(value) ? (defaultValue || 0) : value;
            }
            return defaultValue || 0;
        }

        function setValue(id, value) {
            var element = document.getElementById(id);
            if (element) {
                element.value = value;
            }
        }

        function setText(id, text) {
            var element = document.getElementById(id);
            if (element) {
                element.textContent = text;
            }
        }

        function getText(id) {
            var element = document.getElementById(id);
            return element ? (element.value || element.textContent || '') : '';
        }

        // Employee type update function
        function updateEmployeeType() {
            var employeeType = document.getElementById('employeeType').value;
            var typeDisplay = document.getElementById('typeDisplay');
            
            // Update visual indicator
            if (typeDisplay) {
                if (employeeType === 'individual') {
                    typeDisplay.textContent = 'Individual Contributor';
                    typeDisplay.className = 'indicator individual';
                } else if (employeeType === 'leader') {
                    typeDisplay.textContent = 'People Leader';
                    typeDisplay.className = 'indicator leader';
                } else if (employeeType === 'embedded') {
                    typeDisplay.textContent = 'Embedded';
                    typeDisplay.className = 'indicator embedded';
                }
            }
            
            // Update default values based on employee type
            if (employeeType === 'leader') {
                setValue('utilization', 50);
                setValue('actualUtilization', 55);
                setValue('businessTraining', 35);
                setValue('travel', 40);
            } else if (employeeType === 'embedded') {
                setValue('utilization', 95);
                setValue('actualUtilization', 100);
                setValue('businessTraining', 13);
                setValue('travel', 20);
            } else { // individual contributor
                setValue('utilization', 80);
                setValue('actualUtilization', 85);
                setValue('businessTraining', 13);
                setValue('travel', 20);
            }
            
            // Recalculate everything
            calculateAll();
        }

        // Main calculation function
        function calculateAll() {
            // Get basic values
            var totalHours = getValue('totalHours', 2080);
            var utilization = getValue('utilization', 80);
            var actualUtilization = getValue('actualUtilization', 85);
            
            // Calculate billable/non-billable split
            var billableHours = Math.round(totalHours * (utilization / 100));
            var nonBillableHours = totalHours - billableHours;
            
            // Get all category values
            var pto = getValue('pto', 120);
            var holidays = getValue('holidays', 64);
            var travel = getValue('travel', 20);
            var businessTraining = getValue('businessTraining', 13);
            var techTraining = getValue('techTraining', 30);
            var hiring = getValue('hiring', 20);
            var admin = getValue('admin', 60);
            var innovation = getValue('innovation', 10);
            var culture = getValue('culture', 13);
            var volunteer = getValue('volunteer', 8);
            var optionalDev = getValue('optionalDev', 17);
            var businessActivities = getValue('businessActivities', 31);
            
            // Calculate totals
            var totalAllocated = pto + holidays + travel + businessTraining + techTraining + 
                               hiring + admin + innovation + culture + volunteer + 
                               optionalDev + businessActivities;
            var bufferTime = nonBillableHours - totalAllocated;
            
            // Update display values
            setText('totalHoursResult', totalHours.toLocaleString());
            setText('utilizationResult', utilization + '%');
            setText('actualUtilizationResult', actualUtilization + '%');
            setText('billableResult', billableHours.toLocaleString());
            setText('nonBillableResult', nonBillableHours.toLocaleString());
            
            // Update category results
            setText('ptoResult', pto);
            setText('holidaysResult', holidays);
            setText('travelResult', travel);
            setText('businessTrainingResult', businessTraining);
            setText('techTrainingResult', techTraining);
            setText('hiringResult', hiring);
            setText('adminResult', admin);
            setText('innovationResult', innovation);
            setText('cultureResult', culture);
            setText('volunteerResult', volunteer);
            setText('optionalDevResult', optionalDev);
            setText('businessActivitiesResult', businessActivities);
            
            // Update summary
            setText('totalAllocated', totalAllocated);
            setText('bufferTime', bufferTime);
            
            // Update status
            var statusElement = document.getElementById('statusMessage');
            if (statusElement) {
                if (bufferTime < 0) {
                    statusElement.textContent = 'Status: Over-allocated by ' + Math.abs(bufferTime) + ' hours';
                    statusElement.className = 'alert';
                } else if (bufferTime < 20) {
                    statusElement.textContent = 'Status: Tight allocation - ' + bufferTime + ' hours buffer';
                    statusElement.className = 'warning';
                } else {
                    statusElement.textContent = 'Status: Within limits - ' + bufferTime + ' hours buffer';
                    statusElement.className = 'summary';
                }
            }
            
            // Update utilization warning
            var warningElement = document.getElementById('utilizationWarning');
            if (warningElement) {
                if (actualUtilization > utilization) {
                    warningElement.style.display = 'block';
                    warningElement.textContent = 'Warning: Actual utilization exceeds target by ' + 
                                               (actualUtilization - utilization) + ' percentage points.';
                } else {
                    warningElement.style.display = 'none';
                }
            }
            
            // Update budget tab values
            updateBudgetTotals();
        }

        // Sync basic planning data to budget planning
        function syncBasicToBudget() {
            var employeeName = getText('employeeName');
            if (employeeName) {
                setText('budgetEmployeeName', employeeName);
            } else {
                setText('budgetEmployeeName', 'Enter name in Basic Planning');
            }
            
            var nonBillableHours = getValue('totalHours', 2080) - 
                                 Math.round(getValue('totalHours', 2080) * (getValue('utilization', 80) / 100));
            
            setText('budgetTotal', nonBillableHours + ' hours');
            
            // Sync individual category values
            setValue('budgetPTO', getValue('pto', 120));
            setValue('budgetHolidays', getValue('holidays', 64));
            
            // Calculate strategic time
            var essentialTime = getValue('pto', 120) + getValue('holidays', 64) + 
                              getValue('travel', 20) + getValue('businessTraining', 13) + 
                              getValue('techTraining', 30) + getValue('hiring', 20) + 
                              getValue('admin', 60);
            var strategicTime = nonBillableHours - essentialTime;
            setText('budgetStrategic', strategicTime + ' hours');
            
            calculateBudget();
        }

        // Budget planning calculations
        function calculateBudget() {
            // Calculate all subcategory totals
            var ptoTotal = getValue('budgetPTO', 120) + getValue('budgetPTOOther', 0);
            var holidaysTotal = getValue('budgetHolidays', 64) + getValue('budgetHolidaysOther', 0);
            
            var travelTotal = getValue('budgetConferenceTravel', 10) + 
                            getValue('budgetTrainingTravel', 5) + 
                            getValue('budgetClientTravel', 5) + 
                            getValue('budgetTravelOther', 0);
            
            var businessTrainingTotal = getValue('budgetCompliance', 4) + 
                                      getValue('budgetLeadership', 5) + 
                                      getValue('budgetPlatform', 4) + 
                                      getValue('budgetBusinessTrainingOther', 0);
            
            var techTrainingTotal = getValue('budgetCertifications', 15) + 
                                  getValue('budgetUpskilling', 15) + 
                                  getValue('budgetTechTrainingOther', 0);
            
            var hiringTotal = getValue('budgetInterviewing', 10) + 
                            getValue('budgetRecruiting', 5) + 
                            getValue('budgetOnboarding', 5) + 
                            getValue('budgetHiringOther', 0);
            
            var adminTotal = getValue('budgetReviews', 25) + 
                           getValue('budgetReporting', 20) + 
                           getValue('budgetSurveys', 15) + 
                           getValue('budgetAdminOther', 0);
            
            var innovationTotal = getValue('budgetInnovationProjects', 6) + 
                                getValue('budgetDigitalTransform', 4) + 
                                getValue('budgetInnovationOther', 0);
            
            var cultureTotal = getValue('budgetERG', 8) + 
                             getValue('budgetWellbeing', 3) + 
                             getValue('budgetConnectivity', 2) + 
                             getValue('budgetCultureOther', 0);
            
            var volunteerTotal = getValue('budgetVolunteer', 8) + 
                               getValue('budgetVolunteerOther', 0);
            
            var optionalDevTotal = getValue('budgetExternalConf', 12) + 
                                 getValue('budgetExternalTraining', 5) + 
                                 getValue('budgetOptionalDevOther', 0);
            
            var businessActivitiesTotal = getValue('budgetTeamMeetings', 20) + 
                                        getValue('budgetTownHalls', 6) + 
                                        getValue('budgetCheckins', 5) + 
                                        getValue('budgetBusinessOther', 0);

            // Update category totals
            setText('budgetPTOTotal', ptoTotal);
            setText('budgetHolidaysTotal', holidaysTotal);
            setText('budgetTravelTotal', travelTotal);
            setText('budgetBusinessTrainingTotal', businessTrainingTotal);
            setText('budgetTechTrainingTotal', techTrainingTotal);
            setText('budgetHiringTotal', hiringTotal);
            setText('budgetAdminTotal', adminTotal);
            setText('budgetInnovationTotal', innovationTotal);
            setText('budgetCultureTotal', cultureTotal);
            setText('budgetVolunteerTotal', volunteerTotal);
            setText('budgetOptionalDevTotal', optionalDevTotal);
            setText('budgetBusinessActivitiesTotal', businessActivitiesTotal);

            // Update individual result displays
            setText('budgetPTOResult', getValue('budgetPTO', 120));
            setText('budgetHolidaysResult', getValue('budgetHolidays', 64));
            setText('budgetConferenceTravelResult', getValue('budgetConferenceTravel', 10));
            setText('budgetTrainingTravelResult', getValue('budgetTrainingTravel', 5));
            setText('budgetClientTravelResult', getValue('budgetClientTravel', 5));
            setText('budgetComplianceResult', getValue('budgetCompliance', 4));
            setText('budgetLeadershipResult', getValue('budgetLeadership', 5));
            setText('budgetPlatformResult', getValue('budgetPlatform', 4));
            setText('budgetCertificationsResult', getValue('budgetCertifications', 15));
            setText('budgetUpskillingResult', getValue('budgetUpskilling', 15));
            setText('budgetInterviewingResult', getValue('budgetInterviewing', 10));
            setText('budgetRecruitingResult', getValue('budgetRecruiting', 5));
            setText('budgetOnboardingResult', getValue('budgetOnboarding', 5));
            setText('budgetReviewsResult', getValue('budgetReviews', 25));
            setText('budgetReportingResult', getValue('budgetReporting', 20));
            setText('budgetSurveysResult', getValue('budgetSurveys', 15));
            setText('budgetInnovationProjectsResult', getValue('budgetInnovationProjects', 6));
            setText('budgetDigitalTransformResult', getValue('budgetDigitalTransform', 4));
            setText('budgetERGResult', getValue('budgetERG', 8));
            setText('budgetWellbeingResult', getValue('budgetWellbeing', 3));
            setText('budgetConnectivityResult', getValue('budgetConnectivity', 2));
            setText('budgetVolunteerResult', getValue('budgetVolunteer', 8));
            setText('budgetExternalConfResult', getValue('budgetExternalConf', 12));
            setText('budgetExternalTrainingResult', getValue('budgetExternalTraining', 5));
            setText('budgetTeamMeetingsResult', getValue('budgetTeamMeetings', 20));
            setText('budgetTownHallsResult', getValue('budgetTownHalls', 6));
            setText('budgetCheckinsResult', getValue('budgetCheckins', 5));

            updateBudgetTotals();
        }

        // Update budget summary totals
        function updateBudgetTotals() {
            // Calculate essential vs strategic totals
            var essentialTotal = getValue('budgetPTO', 120) + getValue('budgetPTOOther', 0) +
                               getValue('budgetHolidays', 64) + getValue('budgetHolidaysOther', 0) +
                               (getValue('budgetConferenceTravel', 10) + getValue('budgetTrainingTravel', 5) + 
                                getValue('budgetClientTravel', 5) + getValue('budgetTravelOther', 0)) +
                               (getValue('budgetCompliance', 4) + getValue('budgetLeadership', 5) + 
                                getValue('budgetPlatform', 4) + getValue('budgetBusinessTrainingOther', 0)) +
                               (getValue('budgetCertifications', 15) + getValue('budgetUpskilling', 15) + 
                                getValue('budgetTechTrainingOther', 0)) +
                               (getValue('budgetInterviewing', 10) + getValue('budgetRecruiting', 5) + 
                                getValue('budgetOnboarding', 5) + getValue('budgetHiringOther', 0)) +
                               (getValue('budgetReviews', 25) + getValue('budgetReporting', 20) + 
                                getValue('budgetSurveys', 15) + getValue('budgetAdminOther', 0));
            
            var strategicTotal = (getValue('budgetInnovationProjects', 6) + getValue('budgetDigitalTransform', 4) + 
                                getValue('budgetInnovationOther', 0)) +
                               (getValue('budgetERG', 8) + getValue('budgetWellbeing', 3) + 
                                getValue('budgetConnectivity', 2) + getValue('budgetCultureOther', 0)) +
                               (getValue('budgetVolunteer', 8) + getValue('budgetVolunteerOther', 0)) +
                               (getValue('budgetExternalConf', 12) + getValue('budgetExternalTraining', 5) + 
                                getValue('budgetOptionalDevOther', 0)) +
                               (getValue('budgetTeamMeetings', 20) + getValue('budgetTownHalls', 6) + 
                                getValue('budgetCheckins', 5) + getValue('budgetBusinessOther', 0));
            
            var grandTotal = essentialTotal + strategicTotal;
            
            // Update summary displays
            setText('totalEssentialAllocated', essentialTotal + ' hours');
            setText('totalStrategicAllocated', strategicTotal + ' hours');
            setText('grandTotalAllocated', grandTotal + ' hours');
            
            // Calculate budget status
            var availableHours = getValue('totalHours', 2080) - 
                               Math.round(getValue('totalHours', 2080) * (getValue('utilization', 80) / 100));
            var difference = grandTotal - availableHours;
            
            var statusElement = document.getElementById('budgetStatus');
            var alertElement = document.getElementById('budgetAlert');
            
            if (statusElement && alertElement) {
                if (difference > 0) {
                    setText('budgetStatus', 'Over by ' + difference + ' hours');
                    statusElement.style.color = 'red';
                    alertElement.style.display = 'block';
                } else {
                    setText('budgetStatus', 'Within range');
                    statusElement.style.color = 'green';
                    alertElement.style.display = 'none';
                }
            }
        }

        // CPM Export Functions
        function exportToCPM() {
            try {
                var empName = getText('employeeName') || 'Employee';
                
                // Calculate totals for CPM categories
                var billableHours = Math.round(getValue('totalHours', 2080) * (getValue('utilization', 80) / 100));
                var boldStepHours = getValue('innovation', 10); // Strategy / Innovation
                var ptoHours = getValue('pto', 120); // PTO only, not holidays
                
                // All other indirect = everything else
                var allOtherIndirect = getValue('holidays', 64) + getValue('travel', 20) + 
                                     getValue('businessTraining', 13) + getValue('techTraining', 30) + 
                                     getValue('hiring', 20) + getValue('admin', 60) + 
                                     getValue('culture', 13) + getValue('volunteer', 8) + 
                                     getValue('optionalDev', 17) + getValue('businessActivities', 31);
                
                // Create CPM format data
                var cpmData = [];
                
                // Header row
                var headerRow = ['Accounts by Time'];
                for (var i = 0; i < months2026.length; i++) {
                    headerRow.push(months2026[i].name);
                }
                headerRow.push('FY2026');
                cpmData.push(headerRow);
                
                // Add required CPM structure rows
                cpmData.push(['Headcount']);
                cpmData.push(['Total Direct Hours']);
                cpmData.push(['Partial Headcount']);
                cpmData.push(['Hour Type']);
                cpmData.push(['  Direct Hours']);
                
                // Direct Override row (billable hours)
                var directOverrideRow = ['  Direct Override'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(billableHours * (months2026[i].percentage / 100));
                    directOverrideRow.push(monthlyHours);
                }
                directOverrideRow.push(billableHours);
                cpmData.push(directOverrideRow);
                
                // Bold Step Hours row (Strategy/Innovation)
                var boldStepRow = ['  Bold Step Hours'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(boldStepHours * (months2026[i].percentage / 100));
                    boldStepRow.push(monthlyHours);
                }
                boldStepRow.push(boldStepHours);
                cpmData.push(boldStepRow);
                
                // PTO Usage row
                cpmData.push(['  PTO Usage']);
                
                // PTO Usage Override row
                var ptoOverrideRow = ['  PTO Usage Override'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(ptoHours * (months2026[i].percentage / 100));
                    ptoOverrideRow.push(monthlyHours);
                }
                ptoOverrideRow.push(ptoHours);
                cpmData.push(ptoOverrideRow);
                
                // Company Holiday Hours row
                var holidayHours = getValue('holidays', 64);
                var holidayRow = ['  Company Holiday Hours'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(holidayHours * (months2026[i].percentage / 100));
                    holidayRow.push(monthlyHours);
                }
                holidayRow.push(holidayHours);
                cpmData.push(holidayRow);
                
                // All other Indirect Hours row
                cpmData.push(['  All other Indirect Hours']);
                
                // All other Indirect Override row
                var allOtherRow = ['  All other Indirect Override'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(allOtherIndirect * (months2026[i].percentage / 100));
                    allOtherRow.push(monthlyHours);
                }
                allOtherRow.push(allOtherIndirect);
                cpmData.push(allOtherRow);
                
                // Convert to CSV format
                var csvContent = '';
                for (var i = 0; i < cpmData.length; i++) {
                    var row = cpmData[i];
                    var csvRow = '';
                    for (var j = 0; j < row.length; j++) {
                        var cell = row[j];
                        if (typeof cell === 'string' && cell.indexOf(',') !== -1) {
                            csvRow += '"' + cell + '"';
                        } else {
                            csvRow += cell;
                        }
                        if (j < row.length - 1) {
                            csvRow += ',';
                        }
                    }
                    csvContent += csvRow + '\n';
                }
                
                // Create download
                var blob = new Blob([csvContent], { type: 'text/csv' });
                var url = window.URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = empName.replace(/\s+/g, '_') + '_CPM_Budget_2026.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                
                alert('CPM Export Complete!\n\nFile: ' + empName.replace(/\s+/g, '_') + '_CPM_Budget_2026.csv\n\nThis file is ready for direct import into your company CRM system.');
                
            } catch (error) {
                alert('CPM export failed. Please try again or contact support.');
                console.error('CPM Export Error:', error);
            }
        }

        // Budget CPM Export
        function exportBudgetToCPM() {
            try {
                var empName = getText('employeeName') || 'Employee';
                
                // Calculate totals for CPM categories from budget planning
                var billableHours = Math.round(getValue('totalHours', 2080) * (getValue('utilization', 80) / 100));
                
                // Bold Step = Strategy/Innovation from budget
                var boldStepHours = getValue('budgetInnovationProjects', 6) + 
                                   getValue('budgetDigitalTransform', 4) + 
                                   getValue('budgetInnovationOther', 0);
                
                // PTO = PTO categories only
                var ptoHours = getValue('budgetPTO', 120) + getValue('budgetPTOOther', 0);
                
                // All other indirect = everything else from budget
                var allOtherIndirect = (getValue('budgetHolidays', 64) + getValue('budgetHolidaysOther', 0)) +
                                     (getValue('budgetConferenceTravel', 10) + getValue('budgetTrainingTravel', 5) + 
                                      getValue('budgetClientTravel', 5) + getValue('budgetTravelOther', 0)) +
                                     (getValue('budgetCompliance', 4) + getValue('budgetLeadership', 5) + 
                                      getValue('budgetPlatform', 4) + getValue('budgetBusinessTrainingOther', 0)) +
                                     (getValue('budgetCertifications', 15) + getValue('budgetUpskilling', 15) + 
                                      getValue('budgetTechTrainingOther', 0)) +
                                     (getValue('budgetInterviewing', 10) + getValue('budgetRecruiting', 5) + 
                                      getValue('budgetOnboarding', 5) + getValue('budgetHiringOther', 0)) +
                                     (getValue('budgetReviews', 25) + getValue('budgetReporting', 20) + 
                                      getValue('budgetSurveys', 15) + getValue('budgetAdminOther', 0)) +
                                     (getValue('budgetERG', 8) + getValue('budgetWellbeing', 3) + 
                                      getValue('budgetConnectivity', 2) + getValue('budgetCultureOther', 0)) +
                                     (getValue('budgetVolunteer', 8) + getValue('budgetVolunteerOther', 0)) +
                                     (getValue('budgetExternalConf', 12) + getValue('budgetExternalTraining', 5) + 
                                      getValue('budgetOptionalDevOther', 0)) +
                                     (getValue('budgetTeamMeetings', 20) + getValue('budgetTownHalls', 6) + 
                                      getValue('budgetCheckins', 5) + getValue('budgetBusinessOther', 0));
                
                // Create CPM format data
                var cpmData = [];
                
                // Header row
                var headerRow = ['Accounts by Time'];
                for (var i = 0; i < months2026.length; i++) {
                    headerRow.push(months2026[i].name);
                }
                headerRow.push('FY2026');
                cpmData.push(headerRow);
                
                // Standard CPM structure
                cpmData.push(['Headcount']);
                cpmData.push(['Total Direct Hours']);
                cpmData.push(['Partial Headcount']);
                cpmData.push(['Hour Type']);
                cpmData.push(['  Direct Hours']);
                
                // Direct Override row
                var directOverrideRow = ['  Direct Override'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(billableHours * (months2026[i].percentage / 100));
                    directOverrideRow.push(monthlyHours);
                }
                directOverrideRow.push(billableHours);
                cpmData.push(directOverrideRow);
                
                // Bold Step Hours row
                var boldStepRow = ['  Bold Step Hours'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(boldStepHours * (months2026[i].percentage / 100));
                    boldStepRow.push(monthlyHours);
                }
                boldStepRow.push(boldStepHours);
                cpmData.push(boldStepRow);
                
                cpmData.push(['  PTO Usage']);
                
                // PTO Usage Override row
                var ptoOverrideRow = ['  PTO Usage Override'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(ptoHours * (months2026[i].percentage / 100));
                    ptoOverrideRow.push(monthlyHours);
                }
                ptoOverrideRow.push(ptoHours);
                cpmData.push(ptoOverrideRow);
                
                // Company Holiday Hours row
                var holidayHours = getValue('budgetHolidays', 64) + getValue('budgetHolidaysOther', 0);
                var holidayRow = ['  Company Holiday Hours'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(holidayHours * (months2026[i].percentage / 100));
                    holidayRow.push(monthlyHours);
                }
                holidayRow.push(holidayHours);
                cpmData.push(holidayRow);
                
                cpmData.push(['  All other Indirect Hours']);
                
                // All other Indirect Override row
                var allOtherRow = ['  All other Indirect Override'];
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(allOtherIndirect * (months2026[i].percentage / 100));
                    allOtherRow.push(monthlyHours);
                }
                allOtherRow.push(allOtherIndirect);
                cpmData.push(allOtherRow);
                
                // Convert to CSV
                var csvContent = '';
                for (var i = 0; i < cpmData.length; i++) {
                    var row = cpmData[i];
                    var csvRow = '';
                    for (var j = 0; j < row.length; j++) {
                        var cell = row[j];
                        if (typeof cell === 'string' && cell.indexOf(',') !== -1) {
                            csvRow += '"' + cell + '"';
                        } else {
                            csvRow += cell;
                        }
                        if (j < row.length - 1) {
                            csvRow += ',';
                        }
                    }
                    csvContent += csvRow + '\n';
                }
                
                // Create download
                var blob = new Blob([csvContent], { type: 'text/csv' });
                var url = window.URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = empName.replace(/\s+/g, '_') + '_Budget_CPM_2026.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                
                alert('Budget CPM Export Complete!\n\nFile: ' + empName.replace(/\s+/g, '_') + '_Budget_CPM_2026.csv\n\nDetailed budget breakdown ready for CRM import.');
                
            } catch (error) {
                alert('Budget CPM export failed. Please try again or contact support.');
                console.error('Budget CPM Export Error:', error);
            }
        }

        // Standard export functions
        function exportToCSV() {
            try {
                var empName = getText('employeeName') || 'Employee';
                var csvContent = "Category,Hours\n";
                csvContent += "Employee Name," + empName + "\n";
                csvContent += "Employee Type," + document.getElementById('employeeType').value + "\n";
                csvContent += "Life Line Sector," + document.getElementById('lls').value + "\n";
                csvContent += "Target Utilization," + getValue('utilization', 80) + "%\n";
                csvContent += "PTO," + getValue('pto', 120) + "\n";
                csvContent += "Holiday Hours," + getValue('holidays', 64) + "\n";
                csvContent += "Travel Time," + getValue('travel', 20) + "\n";
                csvContent += "Required Business Training," + getValue('businessTraining', 13) + "\n";
                csvContent += "Technical Training," + getValue('techTraining', 30) + "\n";
                csvContent += "Hiring Activities," + getValue('hiring', 20) + "\n";
                csvContent += "Administrative," + getValue('admin', 60) + "\n";
                csvContent += "Strategy / Innovation," + getValue('innovation', 10) + "\n";
                csvContent += "Culture & Employee Experience," + getValue('culture', 13) + "\n";
                csvContent += "Volunteer Hours," + getValue('volunteer', 8) + "\n";
                csvContent += "Optional Professional Development," + getValue('optionalDev', 17) + "\n";
                csvContent += "Business Activities," + getValue('businessActivities', 31) + "\n";
                
                var blob = new Blob([csvContent], { type: 'text/csv' });
                var url = window.URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = empName.replace(/\s+/g, '_') + '_time_allocation.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            } catch (error) {
                alert('CSV export not available in this environment. Please use CPM export instead.');
            }
        }

        function exportBudgetToCSV() {
            try {
                var empName = getText('employeeName') || 'Employee';
                var csvContent = "Budget Category,Subcategory,Hours\n";
                csvContent += "Employee Name,," + empName + "\n";
                csvContent += "Employee Type,," + document.getElementById('employeeType').value + "\n";
                csvContent += "PTO,Personal/Sick Time," + getValue('budgetPTO', 120) + "\n";
                csvContent += "PTO,Other," + getValue('budgetPTOOther', 0) + "\n";
                csvContent += "Holiday Hours,Company Holidays," + getValue('budgetHolidays', 64) + "\n";
                csvContent += "Holiday Hours,Other," + getValue('budgetHolidaysOther', 0) + "\n";
                csvContent += "Travel,Conference Travel," + getValue('budgetConferenceTravel', 10) + "\n";
                csvContent += "Travel,Training Travel," + getValue('budgetTrainingTravel', 5) + "\n";
                csvContent += "Travel,Client Meeting Travel," + getValue('budgetClientTravel', 5) + "\n";
                csvContent += "Travel,Other," + getValue('budgetTravelOther', 0) + "\n";
                csvContent += "Required Business Training,Compliance Training," + getValue('budgetCompliance', 4) + "\n";
                csvContent += "Required Business Training,Leadership Development," + getValue('budgetLeadership', 5) + "\n";
                csvContent += "Required Business Training,Processes & Platforms," + getValue('budgetPlatform', 4) + "\n";
                csvContent += "Required Business Training,Other," + getValue('budgetBusinessTrainingOther', 0) + "\n";
                csvContent += "Technical Training,Certifications," + getValue('budgetCertifications', 15) + "\n";
                csvContent += "Technical Training,Upskilling/Reskilling," + getValue('budgetUpskilling', 15) + "\n";
                csvContent += "Technical Training,Other," + getValue('budgetTechTrainingOther', 0) + "\n";
                csvContent += "Hiring Activities,Interviewing," + getValue('budgetInterviewing', 10) + "\n";
                csvContent += "Hiring Activities,Recruiting," + getValue('budgetRecruiting', 5) + "\n";
                csvContent += "Hiring Activities,Onboarding," + getValue('budgetOnboarding', 5) + "\n";
                csvContent += "Hiring Activities,Other," + getValue('budgetHiringOther', 0) + "\n";
                csvContent += "Administrative,Performance Reviews," + getValue('budgetReviews', 25) + "\n";
                csvContent += "Administrative,Indirect Reporting," + getValue('budgetReporting', 20) + "\n";
                csvContent += "Administrative,Employee Surveys," + getValue('budgetSurveys', 15) + "\n";
                csvContent += "Administrative,Other," + getValue('budgetAdminOther', 0) + "\n";
                csvContent += "Strategy / Innovation,Innovation / Digital Transformation," + getValue('budgetInnovationProjects', 6) + "\n";
                csvContent += "Strategy / Innovation,Other Strategic Plan," + getValue('budgetDigitalTransform', 4) + "\n";
                csvContent += "Strategy / Innovation,Other," + getValue('budgetInnovationOther', 0) + "\n";
                csvContent += "Culture & Employee Experience,ERG Participation," + getValue('budgetERG', 8) + "\n";
                csvContent += "Culture & Employee Experience,Wellbeing Activities," + getValue('budgetWellbeing', 3) + "\n";
                csvContent += "Culture & Employee Experience,Culture/Connectivity," + getValue('budgetConnectivity', 2) + "\n";
                csvContent += "Culture & Employee Experience,Other," + getValue('budgetCultureOther', 0) + "\n";
                csvContent += "Volunteer Hours,Company Volunteer Time," + getValue('budgetVolunteer', 8) + "\n";
                csvContent += "Volunteer Hours,Other," + getValue('budgetVolunteerOther', 0) + "\n";
                csvContent += "Optional Professional Development,External Conferences," + getValue('budgetExternalConf', 12) + "\n";
                csvContent += "Optional Professional Development,External Training," + getValue('budgetExternalTraining', 5) + "\n";
                csvContent += "Optional Professional Development,Other," + getValue('budgetOptionalDevOther', 0) + "\n";
                csvContent += "Business Activities,Team Meetings," + getValue('budgetTeamMeetings', 20) + "\n";
                csvContent += "Business Activities,Town Halls," + getValue('budgetTownHalls', 6) + "\n";
                csvContent += "Business Activities,Check-ins," + getValue('budgetCheckins', 5) + "\n";
                csvContent += "Business Activities,Other," + getValue('budgetBusinessOther', 0) + "\n";
                
                var blob = new Blob([csvContent], { type: 'text/csv' });
                var url = window.URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = empName.replace(/\s+/g, '_') + '_budget_detail.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            } catch (error) {
                alert('CSV export not available in this environment. Please use CPM export instead.');
            }
        }

        function printReport() {
            window.print();
        }

        function printBudgetReport() {
            showTab('budget');
            setTimeout(function() {
                window.print();
            }, 100);
        }

        function resetForm() {
            if (confirm('Clear all data for next employee?')) {
                // Reset employee name
                setValue('employeeName', '');
                
                // Reset employee type to default
                document.getElementById('employeeType').value = 'individual';
                updateEmployeeType();
                
                // Reset LLS to default
                document.getElementById('lls').value = 'power';
                
                // Recalculate with defaults
                calculateAll();
            }
        }

        function resetBudgetForm() {
            if (confirm('Clear budget data for next employee?')) {
                // Reset employee name
                setValue('employeeName', '');
                setText('budgetEmployeeName', 'Enter name in Basic Planning');
                
                // Reset all budget fields to defaults
                var budgetDefaults = {
                    'budgetPTO': 120, 'budgetPTOOther': 0,
                    'budgetHolidays': 64, 'budgetHolidaysOther': 0,
                    'budgetConferenceTravel': 10, 'budgetTrainingTravel': 5, 'budgetClientTravel': 5, 'budgetTravelOther': 0,
                    'budgetCompliance': 4, 'budgetLeadership': 5, 'budgetPlatform': 4, 'budgetBusinessTrainingOther': 0,
                    'budgetCertifications': 15, 'budgetUpskilling': 15, 'budgetTechTrainingOther': 0,
                    'budgetInterviewing': 10, 'budgetRecruiting': 5, 'budgetOnboarding': 5, 'budgetHiringOther': 0,
                    'budgetReviews': 25, 'budgetReporting': 20, 'budgetSurveys': 15, 'budgetAdminOther': 0,
                    'budgetInnovationProjects': 6, 'budgetDigitalTransform': 4, 'budgetInnovationOther': 0,
                    'budgetERG': 8, 'budgetWellbeing': 3, 'budgetConnectivity': 2, 'budgetCultureOther': 0,
                    'budgetVolunteer': 8, 'budgetVolunteerOther': 0,
                    'budgetExternalConf': 12, 'budgetExternalTraining': 5, 'budgetOptionalDevOther': 0,
                    'budgetTeamMeetings': 20, 'budgetTownHalls': 6, 'budgetCheckins': 5, 'budgetBusinessOther': 0
                };
                
                for (var field in budgetDefaults) {
                    setValue(field, budgetDefaults[field]);
                }
                
                // Clear description fields
                var descFields = [
                    'budgetPTOOtherDesc', 'budgetHolidaysOtherDesc', 'budgetTravelOtherDesc',
                    'budgetBusinessTrainingOtherDesc', 'budgetTechTrainingOtherDesc', 'budgetHiringOtherDesc',
                    'budgetAdminOtherDesc', 'budgetInnovationOtherDesc', 'budgetCultureOtherDesc',
                    'budgetVolunteerOtherDesc', 'budgetOptionalDevOtherDesc', 'budgetBusinessOtherDesc'
                ];
                
                for (var i = 0; i < descFields.length; i++) {
                    setValue(descFields[i], '');
                }
                
                calculateBudget();
            }
        }

        // Initialize the application
        function initializeApp() {
            // Set default employee type
            updateEmployeeType();
            
            // Run initial calculations
            calculateAll();
            calculateBudget();
            
            // Set up event listeners for employee name sync
            var employeeNameField = document.getElementById('employeeName');
            if (employeeNameField) {
                employeeNameField.addEventListener('input', function() {
                    if (currentTab === 'budget') {
                        syncBasicToBudget();
                    }
                });
            }
        }

        // Wait for DOM to be ready and initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
