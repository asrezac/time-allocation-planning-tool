<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Time Allocation Planning Model</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            max-width: 1200px; 
            background: #f5f5f5;
        }
        
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tabs { 
            display: flex; 
            margin-bottom: 20px; 
            border-bottom: 2px solid #007cba;
        }
        
        .tab { 
            padding: 12px 24px; 
            background: #f0f0f0; 
            border: none; 
            cursor: pointer; 
            margin-right: 2px; 
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .tab:hover { 
            background: #e0e0e0; 
        }
        
        .tab.active { 
            background: #007cba; 
            color: white; 
        }
        
        .tab-content { 
            display: none; 
        }
        
        .tab-content.active { 
            display: block; 
        }
        
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            background: #f9f9f9; 
            border-left: 4px solid #007cba; 
            border-radius: 4px;
        }
        
        .guidelines-breakdown {
            background: #e7f3ff;
            border: 1px solid #007cba;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .input-group { 
            display: flex; 
            align-items: center; 
            margin: 10px 0; 
            flex-wrap: wrap;
        }
        
        .input-group label { 
            width: 300px; 
            font-weight: 500;
        }
        
        .input-group input, .input-group select { 
            width: 100px; 
            margin: 0 10px; 
            padding: 8px; 
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .result { 
            background: #e8f5e8; 
            padding: 5px 10px; 
            border-radius: 4px; 
            font-weight: bold; 
            color: #2d5a2d;
        }
        
        .warning { 
            background: #fff3cd; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            border: 1px solid #ffeaa7;
        }
        
        .alert { 
            background: #f8d7da; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            border: 1px solid #f5c6cb;
        }
        
        .summary { 
            background: #d4edda; 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 4px; 
            border: 1px solid #c3e6cb;
        }
        
        .indicator { 
            padding: 3px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
            margin-left: 10px; 
            font-weight: bold;
        }
        
        .individual { background: #4ecdc4; color: white; }
        .leader { background: #9b59b6; color: white; }
        .embedded { background: #ff6b6b; color: white; }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 10px 0; 
        }
        
        th, td { 
            padding: 12px; 
            border: 1px solid #ddd; 
            text-align: left; 
        }
        
        th { 
            background: #f8f9fa; 
            font-weight: bold;
        }
        
        .export-section { 
            background: #e7f3ff; 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 5px; 
            border: 1px solid #007cba; 
        }
        
        .export-btn { 
            background: #007cba; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
            font-weight: bold;
            transition: background 0.3s ease;
        }
        
        .export-btn:hover { 
            background: #005a8b; 
        }
        
        .small-input { 
            width: 60px !important; 
        }
        
        h1 {
            color: #007cba;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h3 {
            color: #333;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Enhanced Time Allocation Planning Model</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('instructions')">Instructions & Guidelines</button>
            <button class="tab" onclick="showTab('basic')">Basic Planning</button>
            <button class="tab" onclick="showTab('budget')">Budget Planning</button>
        </div>

        <!-- Instructions Tab -->
        <div id="instructions" class="tab-content active">
            <div class="section">
                <h3>How to Use This Tool</h3>
                <p><strong>This planning model helps managers and individual contributors work together to allocate employee time between billable and non-billable activities for AOP planning.</strong></p>
                
                <h4>Step-by-Step Instructions:</h4>
                <ol>
                    <li><strong>Collaborative Planning:</strong> Managers and individual contributors should fill this out together</li>
                    <li><strong>Start with Basic Planning:</strong> Select employee type and adjust utilization targets</li>
                    <li><strong>Create Budget:</strong> Use Budget Planning tab to translate into detailed BMO categories for AOP</li>
                    <li><strong>Export to CPM Compatible Sheet:</strong> Generate a CPM-compatible spreadsheet for direct import into company CRM system</li>
                    <li><strong>Adjust as Needed:</strong> Balance allocations to stay within available non-billable time</li>
                </ol>
                
                <h4>CPM Export Features:</h4>
                <ul>
                    <li><strong>Direct CRM Integration:</strong> Export creates spreadsheet in exact CPM format required by company systems</li>
                    <li><strong>Monthly Distribution:</strong> Hours are automatically distributed across 2026 months based on work day percentages</li>
                    <li><strong>Strategic Categorization:</strong> Budget categories roll up into four key CPM buckets for streamlined reporting</li>
                    <li><strong>Annual Planning:</strong> Supports full fiscal year 2026 budgeting with monthly breakdowns</li>
                </ul>
            </div>

            <div class="section">
                <h3>Leadership Accountability Framework</h3>
                <p><strong>People Leaders managing billable employees have a fiduciary responsibility to proactively engage in strategic workforce planning conversations.</strong> This includes conducting structured discussions with team members to identify individual professional development priorities, align personal growth objectives with organizational strategic initiatives, and optimize non-billable time allocation to maximize both employee engagement and business value creation.</p>
            </div>
            
            <div class="section">
                <h3>Strategic Allocation Guidelines for Non-Billable Time</h3>
                <p>To ensure optimal return on human capital investment, managers should implement the following strategic allocation framework for available non-billable hours:</p>
                <ol>
                    <li><strong>25% Optional Training/Development Opportunities</strong> - Builds future capability pipeline and maintains competitive skill sets</li>
                    <li><strong>30% Culture & Employee Experience Activities</strong> - Drives engagement metrics, retention rates, and organizational culture strength</li>
                    <li><strong>45% Business-Related Activities</strong> - Ensures operational excellence and strategic alignment</li>
                </ol>
                <p><em>Note: These percentages should be applied to discretionary time after accounting for mandatory requirements (PTO, holidays, required training, administrative duties).</em></p>
                
                <h4>Cultural Leadership Allocation:</h4>
                <p>For employees interested in cultural leadership roles, allocate:</p>
                <ul>
                    <li><strong>ERG Leader (5 Hours per month)</strong></li>
                    <li><strong>ERG Leader Development Offsite (16 Hours / additional travel)</strong></li>
                    <li><strong>EX Council Member (1-2 Hours per month)</strong></li>
                    <li><strong>Culture Committee Member (5 Hours per month)</strong></li>
                    <li><strong>Culture Committee Chair or Assistant Chair (10 Hours per month)</strong></li>
                </ul>
            </div>

            <div class="section">
                <h3>CPM Export Categories</h3>
                <p><strong>The tool automatically maps your detailed budget planning into four key CPM categories:</strong></p>
                <table>
                    <tr>
                        <th>CPM Category</th>
                        <th>Source Categories</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Direct Override</strong></td>
                        <td>All billable hours</td>
                        <td>Client-facing project work and direct revenue activities</td>
                    </tr>
                    <tr>
                        <td><strong>Bold Step Hours</strong></td>
                        <td>Strategy / Innovation</td>
                        <td>Strategic initiatives, innovation projects, and digital transformation</td>
                    </tr>
                    <tr>
                        <td><strong>PTO Usage Override</strong></td>
                        <td>PTO categories only</td>
                        <td>Personal time off, sick leave, parental leave (excludes company holidays)</td>
                    </tr>
                    <tr>
                        <td><strong>All Other Indirect Override</strong></td>
                        <td>All remaining categories</td>
                        <td>Training, administrative, culture, business activities, holidays</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h3>Employee Type Comparison</h3>
                <table>
                    <tr>
                        <th>Employee Type</th>
                        <th>Target Util%</th>
                        <th>Non-Bill Available</th>
                        <th>Strategic Time</th>
                    </tr>
                    <tr>
                        <td>Individual Contributor</td>
                        <td>80%</td>
                        <td>416 hrs</td>
                        <td>90 hrs</td>
                    </tr>
                    <tr>
                        <td>People Leader</td>
                        <td>50%</td>
                        <td>1040 hrs</td>
                        <td>280 hrs</td>
                    </tr>
                    <tr>
                        <td>Embedded Employee</td>
                        <td>95%</td>
                        <td>104 hrs</td>
                        <td>20 hrs</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Basic Planning Tab -->
        <div id="basic" class="tab-content">
            <div class="section">
                <h3>Employee Configuration</h3>
                <div class="input-group">
                    <label>Employee Name:</label>
                    <input type="text" id="employeeName" placeholder="Enter employee name" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label>Employee Type:</label>
                    <select id="employeeType" onchange="updateEmployeeType()">
                        <option value="individual">Individual Contributor</option>
                        <option value="leader">People Leader</option>
                        <option value="embedded">Embedded (Client Site)</option>
                    </select>
                    <span id="typeDisplay" class="indicator individual">Individual Contributor</span>
                </div>
                <div class="input-group">
                    <label>Life Line Sector (LLS):</label>
                    <select id="lls">
                        <option value="power">Power</option>
                        <option value="renewables">Renewables</option>
                        <option value="transportation">Transportation</option>
                        <option value="water">Water</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Total Hours/Year:</label>
                    <input type="number" id="totalHours" value="2080" onchange="calculateAll()">
                    <span class="result" id="totalHoursResult">2,080</span>
                </div>
                <div class="input-group">
                    <label>Target Utilization %:</label>
                    <input type="number" id="utilization" value="80" onchange="calculateAll()">
                    <span class="result" id="utilizationResult">80%</span>
                </div>
            </div>

            <div class="section">
                <h3>Billable vs Non-Billable Breakdown</h3>
                <div class="input-group">
                    <label>Billable Hours (Target):</label>
                    <span class="result" id="billableResult">1,664</span>
                </div>
                <div class="input-group">
                    <label>Available Non-Billable Hours:</label>
                    <span class="result" id="nonBillableResult">416</span>
                </div>
            </div>

            <div class="section">
                <h3>Essential Non-Billable Categories</h3>
                <div class="input-group">
                    <label>PTO (Personal/Sick Time, parental, medical, bereavement, jury duty):</label>
                    <input type="number" id="pto" value="120" onchange="calculateAll()">
                    <span class="result" id="ptoResult">120</span>
                </div>
                <div class="input-group">
                    <label>Holiday Hours (company holidays):</label>
                    <span class="result" id="holidaysResult">64</span>
                </div>
                <div class="input-group">
                    <label>Travel Time (conferences, training, client meetings, team offsites):</label>
                    <input type="number" id="travel" value="20" onchange="calculateAll()">
                    <span class="result" id="travelResult">20</span>
                </div>
                <div class="input-group">
                    <label>Required Business Training (compliance, platforms, competencies):</label>
                    <input type="number" id="businessTraining" value="13" onchange="calculateAll()">
                    <span class="result" id="businessTrainingResult">13</span>
                </div>
                <div class="input-group">
                    <label>Technical Training (certifications, upskilling, reskilling):</label>
                    <input type="number" id="techTraining" value="30" onchange="calculateAll()">
                    <span class="result" id="techTrainingResult">30</span>
                </div>
                <div class="input-group">
                    <label>Hiring Activities (interviewing, prep, recruiting):</label>
                    <input type="number" id="hiring" value="20" onchange="calculateAll()">
                    <span class="result" id="hiringResult">20</span>
                </div>
                <div class="input-group">
                    <label>Administrative (reviews, reporting, Glint surveys):</label>
                    <input type="number" id="admin" value="30" onchange="calculateAll()">
                    <span class="result" id="adminResult">30</span>
                </div>
            </div>

            <div class="section">
                <h3>Strategic & Development Activities</h3>
                <div class="input-group">
                    <label>Strategy / Innovation:</label>
                    <input type="number" id="innovation" value="19" onchange="calculateAll()">
                    <span class="result" id="innovationResult">19</span>
                </div>
                <div class="input-group">
                    <label>Culture & Employee Experience (ERGs, wellbeing, connectivity):</label>
                    <input type="number" id="culture" value="22" onchange="calculateAll()">
                    <span class="result" id="cultureResult">22</span>
                </div>
                <div class="input-group">
                    <label>Volunteer Hours (8 hours annually per employee):</label>
                    <input type="number" id="volunteer" value="8" onchange="calculateAll()">
                    <span class="result" id="volunteerResult">8</span>
                </div>
                <div class="input-group">
                    <label>Optional Professional Development (conferences, external training):</label>
                    <input type="number" id="optionalDev" value="17" onchange="calculateAll()">
                    <span class="result" id="optionalDevResult">17</span>
                </div>
                <div class="input-group">
                    <label>Business Activities (team meetings, town halls, check-ins, team offsites):</label>
                    <input type="number" id="businessActivities" value="43" onchange="calculateAll()">
                    <span class="result" id="businessActivitiesResult">43</span>
                </div>
            </div>

            <div class="section">
                <h3>Summary</h3>
                <div class="input-group">
                    <label>Total Allocated Non-Billable Hours:</label>
                    <span class="result" id="totalAllocated">416</span>
                </div>
                <div class="input-group">
                    <label>Buffer Time:</label>
                    <span class="result" id="bufferTime">0</span>
                </div>
                <div id="statusMessage" class="summary">Status: Within limits</div>
            </div>

            <div class="export-section">
                <h3>Export & Replication</h3>
                <p><strong>Use these options to save and replicate planning for your team members:</strong></p>
                <button class="export-btn" onclick="exportToCPM()">Export to CPM Compatible</button>
                <button class="export-btn" onclick="resetForm()">Clear for Next Employee</button>
                <p><em>Use CPM Export for direct import into company CRM system. Save each team member's allocation separately for comprehensive AOP planning.</em></p>
            </div>
        </div>

        <!-- Budget Planning Tab -->
        <div id="budget" class="tab-content">
            <div class="section">
                <h3>Complete Budget Planning (BMO Category Breakdown)</h3>
                <p>This tool breaks down your basic planning into detailed BMO budget categories for AOP planning:</p>
                
                <div class="input-group">
                    <label>Employee Name:</label>
                    <div class="result" id="budgetEmployeeName">Enter name in Basic Planning</div>
                </div>
                <div class="input-group">
                    <label>Total Available Non-Billable Hours:</label>
                    <div class="result" id="budgetTotal">416 hours</div>
                </div>
                <div class="input-group">
                    <label>Strategic Time Available (after essentials):</label>
                    <div class="result" id="budgetStrategic">90 hours</div>
                </div>
            </div>

            <div class="guidelines-breakdown">
                <h3>Strategic Allocation Guidelines Breakdown</h3>
                <p><strong>Live calculation based on your current budget allocations:</strong></p>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>25% Optional Training/Development:</strong><br>
                        <span id="guidelineOptionalDev">17 hours</span><br>
                        <small>Optional Professional Development</small>
                    </div>
                    <div>
                        <strong>30% Culture & Employee Experience:</strong><br>
                        <span id="guidelineCulture">30 hours</span><br>
                        <small>Culture/Employee Experience + Volunteer Hours</small>
                    </div>
                    <div>
                        <strong>45% Business-Related Activities:</strong><br>
                        <span id="guidelineBusiness">63 hours</span><br>
                        <small>Travel + Hiring + Administrative + Business Activities</small>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>PTO (Personal/Sick Time)</h3>
                <div class="input-group">
                    <label>PTO - Personal/Sick Time:</label>
                    <input type="number" id="budgetPTO" value="120" onchange="calculateBudget()">
                    <span class="result" id="budgetPTOResult">120</span>
                </div>
                <div class="input-group">
                    <label><strong>Total PTO:</strong></label>
                    <span class="result" id="budgetPTOTotal">120</span>
                </div>
            </div>

            <div class="section">
                <h3>Holiday Hours</h3>
                <div class="input-group">
                    <label>Company Holidays:</label>
                    <span class="result" id="budgetHolidaysResult">64</span>
                </div>
                <div class="input-group">
                    <label><strong>Total Holiday Hours:</strong></label>
                    <span class="result" id="budgetHolidaysTotal">64</span>
                </div>
            </div>

            <div class="section">
                <h3>Travel Time</h3>
                <div class="input-group">
                    <label>Conference Travel:</label>
                    <input type="number" id="budgetConferenceTravel" value="7" onchange="calculateBudget()">
                    <span class="result" id="budgetConferenceTravelResult">7</span>
                </div>
                <div class="input-group">
                    <label>Training Travel:</label>
                    <input type="number" id="budgetTrainingTravel" value="7" onchange="calculateBudget()">
                    <span class="result" id="budgetTrainingTravelResult">7</span>
                </div>
                <div class="input-group">
                    <label>Client Meeting Travel:</label>
                    <input type="number" id="budgetClientTravel" value="6" onchange="calculateBudget()">
                    <span class="result" id="budgetClientTravelResult">6</span>
                </div>
                <div class="input-group">
                    <label>Team Offsites:</label>
                    <input type="number" id="budgetTeamOffsites" value="0" onchange="calculateBudget()">
                    <span class="result" id="budgetTeamOffsitesResult">0</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetTravelOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetTravelOtherDesc" placeholder="Describe other travel" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Travel Time:</strong></label>
                    <span class="result" id="budgetTravelTotal">20</span>
                </div>
            </div>

            <div class="section">
                <h3>Required Business Training</h3>
                <div class="input-group">
                    <label>Compliance Training:</label>
                    <input type="number" id="budgetCompliance" value="4" onchange="calculateBudget()">
                    <span class="result" id="budgetComplianceResult">4</span>
                </div>
                <div class="input-group">
                    <label>Leadership Development:</label>
                    <input type="number" id="budgetLeadership" value="5" onchange="calculateBudget()">
                    <span class="result" id="budgetLeadershipResult">5</span>
                </div>
                <div class="input-group">
                    <label>Processes & Platforms Training:</label>
                    <input type="number" id="budgetPlatform" value="4" onchange="calculateBudget()">
                    <span class="result" id="budgetPlatformResult">4</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetBusinessTrainingOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetBusinessTrainingOtherDesc" placeholder="Describe other training" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Required Business Training:</strong></label>
                    <span class="result" id="budgetBusinessTrainingTotal">13</span>
                </div>
            </div>

            <div class="section">
                <h3>Technical Training</h3>
                <div class="input-group">
                    <label>Certifications:</label>
                    <input type="number" id="budgetCertifications" value="15" onchange="calculateBudget()">
                    <span class="result" id="budgetCertificationsResult">15</span>
                </div>
                <div class="input-group">
                    <label>Upskilling/Reskilling:</label>
                    <input type="number" id="budgetUpskilling" value="15" onchange="calculateBudget()">
                    <span class="result" id="budgetUpskillingResult">15</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetTechTrainingOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetTechTrainingOtherDesc" placeholder="Describe other technical training" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Technical Training:</strong></label>
                    <span class="result" id="budgetTechTrainingTotal">30</span>
                </div>
            </div>

            <div class="section">
                <h3>Hiring Activities</h3>
                <div class="input-group">
                    <label>Recruiting:</label>
                    <input type="number" id="budgetRecruiting" value="2" onchange="calculateBudget()">
                    <span class="result" id="budgetRecruitingResult">2</span>
                </div>
                <div class="input-group">
                    <label>Interviewing:</label>
                    <input type="number" id="budgetInterviewing" value="6" onchange="calculateBudget()">
                    <span class="result" id="budgetInterviewingResult">6</span>
                </div>
                <div class="input-group">
                    <label>Onboarding:</label>
                    <input type="number" id="budgetOnboarding" value="12" onchange="calculateBudget()">
                    <span class="result" id="budgetOnboardingResult">12</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetHiringOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetHiringOtherDesc" placeholder="Describe other hiring activities" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Hiring Activities:</strong></label>
                    <span class="result" id="budgetHiringTotal">20</span>
                </div>
            </div>

            <div class="section">
                <h3>Administrative</h3>
                <div class="input-group">
                    <label>Performance Reviews:</label>
                    <input type="number" id="budgetReviews" value="12" onchange="calculateBudget()">
                    <span class="result" id="budgetReviewsResult">12</span>
                </div>
                <div class="input-group">
                    <label>Indirect Reporting:</label>
                    <input type="number" id="budgetReporting" value="12" onchange="calculateBudget()">
                    <span class="result" id="budgetReportingResult">12</span>
                </div>
                <div class="input-group">
                    <label>Employee Surveys (Glint):</label>
                    <input type="number" id="budgetSurveys" value="6" onchange="calculateBudget()">
                    <span class="result" id="budgetSurveysResult">6</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetAdminOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetAdminOtherDesc" placeholder="Describe other administrative work" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Administrative:</strong></label>
                    <span class="result" id="budgetAdminTotal">30</span>
                </div>
            </div>

            <div class="section">
                <h3>Strategy / Innovation (Formerly Bold Step)</h3>
                <div class="input-group">
                    <label>Innovation / Digital Transformation:</label>
                    <input type="number" id="budgetInnovationProjects" value="10" onchange="calculateBudget()">
                    <span class="result" id="budgetInnovationProjectsResult">10</span>
                </div>
                <div class="input-group">
                    <label>Other Strategic Plan:</label>
                    <input type="number" id="budgetDigitalTransform" value="9" onchange="calculateBudget()">
                    <span class="result" id="budgetDigitalTransformResult">9</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetInnovationOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetInnovationOtherDesc" placeholder="Describe other strategy work" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Strategy / Innovation:</strong></label>
                    <span class="result" id="budgetInnovationTotal">19</span>
                </div>
            </div>

            <div class="section">
                <h3>Culture & Employee Experience</h3>
                <div class="input-group">
                    <label>ERG Member (1-2 Hours per month):</label>
                    <input type="number" id="budgetERGMember" value="7" onchange="calculateBudget()">
                    <span class="result" id="budgetERGMemberResult">7</span>
                </div>
                <div class="input-group">
                    <label>ERG Leader (5 Hours per month):</label>
                    <input type="number" id="budgetERGLeader" value="0" onchange="calculateBudget()">
                    <span class="result" id="budgetERGLeaderResult">0</span>
                </div>
                <div class="input-group">
                    <label>ERG Leader Development Offsite (16 Hours / additional travel):</label>
                    <input type="number" id="budgetERGOffsite" value="0" onchange="calculateBudget()">
                    <span class="result" id="budgetERGOffsiteResult">0</span>
                </div>
                <div class="input-group">
                    <label>EX Council (1-2 Hours per month):</label>
                    <input type="number" id="budgetEXCouncil" value="0" onchange="calculateBudget()">
                    <span class="result" id="budgetEXCouncilResult">0</span>
                </div>
                <div class="input-group">
                    <label>Culture Committee Member (5 Hours per month):</label>
                    <input type="number" id="budgetCultureMember" value="0" onchange="calculateBudget()">
                    <span class="result" id="budgetCultureMemberResult">0</span>
                </div>
                <div class="input-group">
                    <label>Culture Committee Chair or Assistant Chair (10 Hours per month):</label>
                    <input type="number" id="budgetCultureChair" value="0" onchange="calculateBudget()">
                    <span class="result" id="budgetCultureChairResult">0</span>
                </div>
                <div class="input-group">
                    <label>Wellbeing Activities:</label>
                    <input type="number" id="budgetWellbeing" value="7" onchange="calculateBudget()">
                    <span class="result" id="budgetWellbeingResult">7</span>
                </div>
                <div class="input-group">
                    <label>Culture / Connectivity Activities:</label>
                    <input type="number" id="budgetConnectivity" value="8" onchange="calculateBudget()">
                    <span class="result" id="budgetConnectivityResult">8</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetCultureOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetCultureOtherDesc" placeholder="Describe other culture activities" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Culture & Employee Experience:</strong></label>
                    <span class="result" id="budgetCultureTotal">22</span>
                </div>
            </div>

            <div class="section">
                <h3>Volunteer Hours</h3>
                <div class="input-group">
                    <label>Company Volunteer Time:</label>
                    <input type="number" id="budgetVolunteer" value="8" onchange="calculateBudget()">
                    <span class="result" id="budgetVolunteerResult">8</span>
                </div>
                <div class="input-group">
                    <label><strong>Total Volunteer Hours:</strong></label>
                    <span class="result" id="budgetVolunteerTotal">8</span>
                </div>
            </div>

            <div class="section">
                <h3>Optional Professional Development</h3>
                <div class="input-group">
                    <label>External Conferences:</label>
                    <input type="number" id="budgetExternalConf" value="8" onchange="calculateBudget()">
                    <span class="result" id="budgetExternalConfResult">8</span>
                </div>
                <div class="input-group">
                    <label>External Training:</label>
                    <input type="number" id="budgetExternalTraining" value="9" onchange="calculateBudget()">
                    <span class="result" id="budgetExternalTrainingResult">9</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetOptionalDevOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetOptionalDevOtherDesc" placeholder="Describe other professional development" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Optional Professional Development:</strong></label>
                    <span class="result" id="budgetOptionalDevTotal">17</span>
                </div>
            </div>

            <div class="section">
                <h3>Business Activities</h3>
                <div class="input-group">
                    <label>Team Meetings:</label>
                    <input type="number" id="budgetTeamMeetings" value="26" onchange="calculateBudget()">
                    <span class="result" id="budgetTeamMeetingsResult">26</span>
                </div>
                <div class="input-group">
                    <label>Town Halls:</label>
                    <input type="number" id="budgetTownHalls" value="1" onchange="calculateBudget()">
                    <span class="result" id="budgetTownHallsResult">1</span>
                </div>
                <div class="input-group">
                    <label>Check-ins:</label>
                    <input type="number" id="budgetCheckins" value="16" onchange="calculateBudget()">
                    <span class="result" id="budgetCheckinsResult">16</span>
                </div>
                <div class="input-group">
                    <label>Team Offsites:</label>
                    <input type="number" id="budgetBusinessOffsites" value="0" onchange="calculateBudget()">
                    <span class="result" id="budgetBusinessOffsitesResult">0</span>
                </div>
                <div class="input-group">
                    <label>Proposals Work:</label>
                    <input type="number" id="budgetProposals" value="0" onchange="calculateBudget()">
                    <span class="result" id="budgetProposalsResult">0</span>
                </div>
                <div class="input-group">
                    <label>Other:</label>
                    <input type="number" id="budgetBusinessOther" value="0" onchange="calculateBudget()" class="small-input">
                    <input type="text" id="budgetBusinessOtherDesc" placeholder="Describe other business activities" style="width: 200px;">
                </div>
                <div class="input-group">
                    <label><strong>Total Business Activities:</strong></label>
                    <span class="result" id="budgetBusinessActivitiesTotal">43</span>
                </div>
            </div>

            <div class="summary">
                <h3>Complete Budget Summary</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>Total Essential Hours:</strong><br>
                        <span id="totalEssentialAllocated">327 hours</span>
                    </div>
                    <div>
                        <strong>Total Strategic Hours:</strong><br>
                        <span id="totalStrategicAllocated">89 hours</span>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <strong>Grand Total Allocated:</strong><br>
                        <span id="grandTotalAllocated">416 hours</span>
                    </div>
                    <div>
                        <strong>Budget Status:</strong><br>
                        <span id="budgetStatus" style="color: green;">Within range</span>
                    </div>
                </div>
                
                <div id="budgetAlert" class="alert" style="display: none;">
                    <strong>Budget Alert:</strong> Total allocation exceeds available time.
                </div>
            </div>

            <div class="export-section">
                <h3>Export Budget Planning</h3>
                <p><strong>Save your detailed budget breakdown:</strong></p>
                <button class="export-btn" onclick="exportBudgetToCPM()">Export to CPM Compatible</button>
                <button class="export-btn" onclick="printBudgetReport()">Print Budget Report</button>
                <button class="export-btn" onclick="resetBudgetForm()">Clear Budget for Next Employee</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        var currentTab = 'instructions';
        
        // Monthly work hours for 2026 with percentages
        var months2026 = [
            { name: 'Jan-2026', hours: 176, percentage: 8.33 },
            { name: 'Feb-2026', hours: 160, percentage: 7.69 },
            { name: 'Mar-2026', hours: 168, percentage: 8.08 },
            { name: 'Apr-2026', hours: 176, percentage: 8.46 },
            { name: 'May-2026', hours: 160, percentage: 7.69 },
            { name: 'Jun-2026', hours: 176, percentage: 8.46 },
            { name: 'Jul-2026', hours: 168, percentage: 8.08 },
            { name: 'Aug-2026', hours: 168, percentage: 8.08 },
            { name: 'Sep-2026', hours: 168, percentage: 8.08 },
            { name: 'Oct-2026', hours: 176, percentage: 8.46 },
            { name: 'Nov-2026', hours: 160, percentage: 7.69 },
            { name: 'Dec-2026', hours: 176, percentage: 8.46 }
        ];
        
        // Tab switching function
        function showTab(tabName) {
            // Hide all tab contents
            var tabContents = document.getElementsByClassName('tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Remove active class from all tabs
            var tabs = document.getElementsByClassName('tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Show the selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update current tab
            currentTab = tabName;
            
            // Sync data when switching to budget tab
            if (tabName === 'budget') {
                syncBasicToBudget();
            }
        }

        // Helper functions for safe DOM manipulation
        function getValue(id, defaultValue) {
            var element = document.getElementById(id);
            if (element && element.value !== undefined && element.value !== '') {
                var value = parseFloat(element.value);
                return isNaN(value) ? (defaultValue || 0) : value;
            }
            return defaultValue || 0;
        }

        function setValue(id, value) {
            var element = document.getElementById(id);
            if (element) {
                element.value = value;
            }
        }

        function setText(id, text) {
            var element = document.getElementById(id);
            if (element) {
                element.textContent = text;
            }
        }

        function getText(id) {
            var element = document.getElementById(id);
            return element ? (element.value || element.textContent || '') : '';
        }

        // Employee type update function
        function updateEmployeeType() {
            var employeeType = document.getElementById('employeeType').value;
            var typeDisplay = document.getElementById('typeDisplay');
            
            // Update visual indicator
            if (typeDisplay) {
                if (employeeType === 'individual') {
                    typeDisplay.textContent = 'Individual Contributor';
                    typeDisplay.className = 'indicator individual';
                } else if (employeeType === 'leader') {
                    typeDisplay.textContent = 'People Leader';
                    typeDisplay.className = 'indicator leader';
                } else if (employeeType === 'embedded') {
                    typeDisplay.textContent = 'Embedded';
                    typeDisplay.className = 'indicator embedded';
                }
            }
            
            // Update default values based on employee type
            if (employeeType === 'leader') {
                setValue('utilization', 50);
                setValue('businessTraining', 35);
                setValue('travel', 40);
                setValue('admin', 50);
                setValue('innovation', 22);
                setValue('culture', 31);
                setValue('businessActivities', 52);
            } else if (employeeType === 'embedded') {
                setValue('utilization', 95);
                setValue('businessTraining', 13);
                setValue('travel', 20);
                setValue('admin', 30);
                setValue('innovation', 19);
                setValue('culture', 22);
                setValue('businessActivities', 43);
            } else { // individual contributor
                setValue('utilization', 80);
                setValue('businessTraining', 13);
                setValue('travel', 20);
                setValue('admin', 30);
                setValue('innovation', 19);
                setValue('culture', 22);
                setValue('businessActivities', 43);
            }
            
            // Recalculate everything
            calculateAll();
        }

        // Main calculation function
        function calculateAll() {
            // Get basic values
            var totalHours = getValue('totalHours', 2080);
            var utilization = getValue('utilization', 80);
            
            // Calculate billable/non-billable split
            var billableHours = Math.round(totalHours * (utilization / 100));
            var nonBillableHours = totalHours - billableHours;
            
            // Get all category values
            var pto = getValue('pto', 120);
            var holidays = 64; // Fixed value
            var travel = getValue('travel', 20);
            var businessTraining = getValue('businessTraining', 13);
            var techTraining = getValue('techTraining', 30);
            var hiring = getValue('hiring', 20);
            var admin = getValue('admin', 30);
            var innovation = getValue('innovation', 19);
            var culture = getValue('culture', 22);
            var volunteer = getValue('volunteer', 8);
            var optionalDev = getValue('optionalDev', 17);
            var businessActivities = getValue('businessActivities', 43);
            
            // Calculate totals
            var totalAllocated = pto + holidays + travel + businessTraining + techTraining + 
                               hiring + admin + innovation + culture + volunteer + 
                               optionalDev + businessActivities;
            var bufferTime = nonBillableHours - totalAllocated;
            
            // Update display values
            setText('totalHoursResult', totalHours.toLocaleString());
            setText('utilizationResult', utilization + '%');
            setText('billableResult', billableHours.toLocaleString());
            setText('nonBillableResult', nonBillableHours.toLocaleString());
            
            // Update category results
            setText('ptoResult', pto);
            setText('holidaysResult', holidays);
            setText('travelResult', travel);
            setText('businessTrainingResult', businessTraining);
            setText('techTrainingResult', techTraining);
            setText('hiringResult', hiring);
            setText('adminResult', admin);
            setText('innovationResult', innovation);
            setText('cultureResult', culture);
            setText('volunteerResult', volunteer);
            setText('optionalDevResult', optionalDev);
            setText('businessActivitiesResult', businessActivities);
            
            // Update summary
            setText('totalAllocated', totalAllocated);
            setText('bufferTime', bufferTime);
            
            // Update status
            var statusElement = document.getElementById('statusMessage');
            if (statusElement) {
                if (bufferTime < 0) {
                    statusElement.textContent = 'Status: Over-allocated by ' + Math.abs(bufferTime) + ' hours';
                    statusElement.className = 'alert';
                } else if (bufferTime < 20) {
                    statusElement.textContent = 'Status: Tight allocation - ' + bufferTime + ' hours buffer';
                    statusElement.className = 'warning';
                } else {
                    statusElement.textContent = 'Status: Within limits - ' + bufferTime + ' hours buffer';
                    statusElement.className = 'summary';
                }
            }
            
            // Update budget tab values
            updateBudgetTotals();
        }

        // Sync basic planning data to budget planning
        function syncBasicToBudget() {
            var employeeName = getText('employeeName');
            if (employeeName) {
                setText('budgetEmployeeName', employeeName);
            } else {
                setText('budgetEmployeeName', 'Enter name in Basic Planning');
            }
            
            var nonBillableHours = getValue('totalHours', 2080) - 
                                 Math.round(getValue('totalHours', 2080) * (getValue('utilization', 80) / 100));
            
            setText('budgetTotal', nonBillableHours + ' hours');
            
            // Sync PTO
            setValue('budgetPTO', getValue('pto', 120));
            
            // Sync travel time - even split (excluding other)
            var travelHours = getValue('travel', 20);
            setValue('budgetConferenceTravel', Math.round(travelHours / 3));
            setValue('budgetTrainingTravel', Math.round(travelHours / 3));
            setValue('budgetClientTravel', travelHours - (2 * Math.round(travelHours / 3)));
            
            // Sync business training - even split (excluding other)
            var businessTrainingHours = getValue('businessTraining', 13);
            setValue('budgetCompliance', Math.round(businessTrainingHours / 3));
            setValue('budgetLeadership', Math.round(businessTrainingHours / 3));
            setValue('budgetPlatform', businessTrainingHours - (2 * Math.round(businessTrainingHours / 3)));
            
            // Sync technical training - even split (excluding other)
            var techTrainingHours = getValue('techTraining', 30);
            setValue('budgetCertifications', Math.round(techTrainingHours / 2));
            setValue('budgetUpskilling', techTrainingHours - Math.round(techTrainingHours / 2));
            
            // Sync hiring - 10% recruiting, 30% interviewing, 60% onboarding
            var hiringHours = getValue('hiring', 20);
            setValue('budgetRecruiting', Math.round(hiringHours * 0.1));
            setValue('budgetInterviewing', Math.round(hiringHours * 0.3));
            setValue('budgetOnboarding', hiringHours - Math.round(hiringHours * 0.1) - Math.round(hiringHours * 0.3));
            
            // Sync administrative - 40% reviews, 40% reporting, 20% surveys
            var adminHours = getValue('admin', 30);
            setValue('budgetReviews', Math.round(adminHours * 0.4));
            setValue('budgetReporting', Math.round(adminHours * 0.4));
            setValue('budgetSurveys', adminHours - (2 * Math.round(adminHours * 0.4)));
            
            // Sync innovation - even split (excluding other)
            var innovationHours = getValue('innovation', 19);
            setValue('budgetInnovationProjects', Math.round(innovationHours / 2));
            setValue('budgetDigitalTransform', innovationHours - Math.round(innovationHours / 2));
            
            // Sync culture - even split between ERG Member, Wellbeing, and Connectivity
            var cultureHours = getValue('culture', 22);
            setValue('budgetERGMember', Math.round(cultureHours / 3));
            setValue('budgetWellbeing', Math.round(cultureHours / 3));
            setValue('budgetConnectivity', cultureHours - (2 * Math.round(cultureHours / 3)));
            
            // Sync volunteer - 8 hours (excluding other)
            setValue('budgetVolunteer', getValue('volunteer', 8));
            
            // Sync optional development - even split (excluding other)
            var optionalDevHours = getValue('optionalDev', 17);
            setValue('budgetExternalConf', Math.round(optionalDevHours / 2));
            setValue('budgetExternalTraining', optionalDevHours - Math.round(optionalDevHours / 2));
            
            // Sync business activities - 60% team meetings, 2% town halls, 38% check-ins
            var businessHours = getValue('businessActivities', 43);
            setValue('budgetTeamMeetings', Math.round(businessHours * 0.6));
            setValue('budgetTownHalls', Math.round(businessHours * 0.02));
            setValue('budgetCheckins', businessHours - Math.round(businessHours * 0.6) - Math.round(businessHours * 0.02));
            
            // Calculate strategic time
            var essentialTime = getValue('pto', 120) + 64 + 
                              getValue('travel', 20) + getValue('businessTraining', 13) + 
                              getValue('techTraining', 30) + getValue('hiring', 20) + 
                              getValue('admin', 30);
            var strategicTime = nonBillableHours - essentialTime;
            setText('budgetStrategic', strategicTime + ' hours');
            
            calculateBudget();
        }

        // Budget planning calculations
        function calculateBudget() {
            // Calculate all subcategory totals
            var ptoTotal = getValue('budgetPTO', 120);
            var holidaysTotal = 64; // Fixed
            
            var travelTotal = getValue('budgetConferenceTravel', 7) + 
                            getValue('budgetTrainingTravel', 7) + 
                            getValue('budgetClientTravel', 6) + 
                            getValue('budgetTeamOffsites', 0) +
                            getValue('budgetTravelOther', 0);
            
            var businessTrainingTotal = getValue('budgetCompliance', 4) + 
                                      getValue('budgetLeadership', 5) + 
                                      getValue('budgetPlatform', 4) + 
                                      getValue('budgetBusinessTrainingOther', 0);
            
            var techTrainingTotal = getValue('budgetCertifications', 15) + 
                                  getValue('budgetUpskilling', 15) + 
                                  getValue('budgetTechTrainingOther', 0);
            
            var hiringTotal = getValue('budgetRecruiting', 2) + 
                            getValue('budgetInterviewing', 6) + 
                            getValue('budgetOnboarding', 12) + 
                            getValue('budgetHiringOther', 0);
            
            var adminTotal = getValue('budgetReviews', 12) + 
                           getValue('budgetReporting', 12) + 
                           getValue('budgetSurveys', 6) + 
                           getValue('budgetAdminOther', 0);
            
            var innovationTotal = getValue('budgetInnovationProjects', 10) + 
                                getValue('budgetDigitalTransform', 9) + 
                                getValue('budgetInnovationOther', 0);
            
            var cultureTotal = getValue('budgetERGMember', 7) + 
                             getValue('budgetERGLeader', 0) + 
                             getValue('budgetERGOffsite', 0) +
                             getValue('budgetEXCouncil', 0) +
                             getValue('budgetCultureMember', 0) +
                             getValue('budgetCultureChair', 0) +
                             getValue('budgetWellbeing', 7) + 
                             getValue('budgetConnectivity', 8) + 
                             getValue('budgetCultureOther', 0);
            
            var volunteerTotal = getValue('budgetVolunteer', 8);
            
            var optionalDevTotal = getValue('budgetExternalConf', 8) + 
                                 getValue('budgetExternalTraining', 9) + 
                                 getValue('budgetOptionalDevOther', 0);
            
            var businessActivitiesTotal = getValue('budgetTeamMeetings', 26) + 
                                        getValue('budgetTownHalls', 1) + 
                                        getValue('budgetCheckins', 16) + 
                                        getValue('budgetBusinessOffsites', 0) +
                                        getValue('budgetProposals', 0) +
                                        getValue('budgetBusinessOther', 0);

            // Update category totals
            setText('budgetPTOTotal', ptoTotal);
            setText('budgetHolidaysTotal', holidaysTotal);
            setText('budgetTravelTotal', travelTotal);
            setText('budgetBusinessTrainingTotal', businessTrainingTotal);
            setText('budgetTechTrainingTotal', techTrainingTotal);
            setText('budgetHiringTotal', hiringTotal);
            setText('budgetAdminTotal', adminTotal);
            setText('budgetInnovationTotal', innovationTotal);
            setText('budgetCultureTotal', cultureTotal);
            setText('budgetVolunteerTotal', volunteerTotal);
            setText('budgetOptionalDevTotal', optionalDevTotal);
            setText('budgetBusinessActivitiesTotal', businessActivitiesTotal);

            // Update individual result displays
            setText('budgetPTOResult', getValue('budgetPTO', 120));
            setText('budgetHolidaysResult', 64);
            setText('budgetConferenceTravelResult', getValue('budgetConferenceTravel', 7));
            setText('budgetTrainingTravelResult', getValue('budgetTrainingTravel', 7));
            setText('budgetClientTravelResult', getValue('budgetClientTravel', 6));
            setText('budgetTeamOffsitesResult', getValue('budgetTeamOffsites', 0));
            setText('budgetComplianceResult', getValue('budgetCompliance', 4));
            setText('budgetLeadershipResult', getValue('budgetLeadership', 5));
            setText('budgetPlatformResult', getValue('budgetPlatform', 4));
            setText('budgetCertificationsResult', getValue('budgetCertifications', 15));
            setText('budgetUpskillingResult', getValue('budgetUpskilling', 15));
            setText('budgetRecruitingResult', getValue('budgetRecruiting', 2));
            setText('budgetInterviewingResult', getValue('budgetInterviewing', 6));
            setText('budgetOnboardingResult', getValue('budgetOnboarding', 12));
            setText('budgetReviewsResult', getValue('budgetReviews', 12));
            setText('budgetReportingResult', getValue('budgetReporting', 12));
            setText('budgetSurveysResult', getValue('budgetSurveys', 6));
            setText('budgetInnovationProjectsResult', getValue('budgetInnovationProjects', 10));
            setText('budgetDigitalTransformResult', getValue('budgetDigitalTransform', 9));
            setText('budgetERGMemberResult', getValue('budgetERGMember', 7));
            setText('budgetERGLeaderResult', getValue('budgetERGLeader', 0));
            setText('budgetERGOffsiteResult', getValue('budgetERGOffsite', 0));
            setText('budgetEXCouncilResult', getValue('budgetEXCouncil', 0));
            setText('budgetCultureMemberResult', getValue('budgetCultureMember', 0));
            setText('budgetCultureChairResult', getValue('budgetCultureChair', 0));
            setText('budgetWellbeingResult', getValue('budgetWellbeing', 7));
            setText('budgetConnectivityResult', getValue('budgetConnectivity', 8));
            setText('budgetVolunteerResult', getValue('budgetVolunteer', 8));
            setText('budgetExternalConfResult', getValue('budgetExternalConf', 8));
            setText('budgetExternalTrainingResult', getValue('budgetExternalTraining', 9));
            setText('budgetTeamMeetingsResult', getValue('budgetTeamMeetings', 26));
            setText('budgetTownHallsResult', getValue('budgetTownHalls', 1));
            setText('budgetCheckinsResult', getValue('budgetCheckins', 16));
            setText('budgetBusinessOffsitesResult', getValue('budgetBusinessOffsites', 0));
            setText('budgetProposalsResult', getValue('budgetProposals', 0));

            // Calculate guidelines breakdown
            updateGuidelinesBreakdown();

            updateBudgetTotals();
        }

        // Update guidelines breakdown calculation
        function updateGuidelinesBreakdown() {
            // Calculate strategic hours (excluding required training)
            var strategicForGuidelines = getValue('budgetConferenceTravel', 7) + 
                                       getValue('budgetTrainingTravel', 7) + 
                                       getValue('budgetClientTravel', 6) + 
                                       getValue('budgetTeamOffsites', 0) +
                                       getValue('budgetTravelOther', 0) +
                                       getValue('budgetRecruiting', 2) + 
                                       getValue('budgetInterviewing', 6) + 
                                       getValue('budgetOnboarding', 12) + 
                                       getValue('budgetHiringOther', 0) +
                                       getValue('budgetReviews', 12) + 
                                       getValue('budgetReporting', 12) + 
                                       getValue('budgetSurveys', 6) + 
                                       getValue('budgetAdminOther', 0) +
                                       getValue('budgetERGMember', 7) + 
                                       getValue('budgetERGLeader', 0) + 
                                       getValue('budgetERGOffsite', 0) +
                                       getValue('budgetEXCouncil', 0) +
                                       getValue('budgetCultureMember', 0) +
                                       getValue('budgetCultureChair', 0) +
                                       getValue('budgetWellbeing', 7) + 
                                       getValue('budgetConnectivity', 8) + 
                                       getValue('budgetCultureOther', 0) +
                                       getValue('budgetVolunteer', 8) +
                                       getValue('budgetExternalConf', 8) + 
                                       getValue('budgetExternalTraining', 9) + 
                                       getValue('budgetOptionalDevOther', 0) +
                                       getValue('budgetTeamMeetings', 26) + 
                                       getValue('budgetTownHalls', 1) + 
                                       getValue('budgetCheckins', 16) + 
                                       getValue('budgetBusinessOffsites', 0) +
                                       getValue('budgetProposals', 0) +
                                       getValue('budgetBusinessOther', 0);

            // Calculate by guideline category
            var optionalDevHours = getValue('budgetExternalConf', 8) + 
                                 getValue('budgetExternalTraining', 9) + 
                                 getValue('budgetOptionalDevOther', 0);

            var cultureHours = getValue('budgetERGMember', 7) + 
                             getValue('budgetERGLeader', 0) + 
                             getValue('budgetERGOffsite', 0) +
                             getValue('budgetEXCouncil', 0) +
                             getValue('budgetCultureMember', 0) +
                             getValue('budgetCultureChair', 0) +
                             getValue('budgetWellbeing', 7) + 
                             getValue('budgetConnectivity', 8) + 
                             getValue('budgetCultureOther', 0) +
                             getValue('budgetVolunteer', 8);

            var businessHours = getValue('budgetConferenceTravel', 7) + 
                              getValue('budgetTrainingTravel', 7) + 
                              getValue('budgetClientTravel', 6) + 
                              getValue('budgetTeamOffsites', 0) +
                              getValue('budgetTravelOther', 0) +
                              getValue('budgetRecruiting', 2) + 
                              getValue('budgetInterviewing', 6) + 
                              getValue('budgetOnboarding', 12) + 
                              getValue('budgetHiringOther', 0) +
                              getValue('budgetReviews', 12) + 
                              getValue('budgetReporting', 12) + 
                              getValue('budgetSurveys', 6) + 
                              getValue('budgetAdminOther', 0) +
                              getValue('budgetTeamMeetings', 26) + 
                              getValue('budgetTownHalls', 1) + 
                              getValue('budgetCheckins', 16) + 
                              getValue('budgetBusinessOffsites', 0) +
                              getValue('budgetProposals', 0) +
                              getValue('budgetBusinessOther', 0);

            setText('guidelineOptionalDev', optionalDevHours + ' hours');
            setText('guidelineCulture', cultureHours + ' hours');
            setText('guidelineBusiness', businessHours + ' hours');
        }

        // Update budget summary totals
        function updateBudgetTotals() {
            // Calculate essential vs strategic totals
            var essentialTotal = getValue('budgetPTO', 120) + 64 +
                               (getValue('budgetConferenceTravel', 7) + getValue('budgetTrainingTravel', 7) + 
                                getValue('budgetClientTravel', 6) + getValue('budgetTeamOffsites', 0) + getValue('budgetTravelOther', 0)) +
                               (getValue('budgetCompliance', 4) + getValue('budgetLeadership', 5) + 
                                getValue('budgetPlatform', 4) + getValue('budgetBusinessTrainingOther', 0)) +
                               (getValue('budgetCertifications', 15) + getValue('budgetUpskilling', 15) + 
                                getValue('budgetTechTrainingOther', 0)) +
                               (getValue('budgetRecruiting', 2) + getValue('budgetInterviewing', 6) + 
                                getValue('budgetOnboarding', 12) + getValue('budgetHiringOther', 0)) +
                               (getValue('budgetReviews', 12) + getValue('budgetReporting', 12) + 
                                getValue('budgetSurveys', 6) + getValue('budgetAdminOther', 0));
            
            var strategicTotal = (getValue('budgetInnovationProjects', 10) + getValue('budgetDigitalTransform', 9) + 
                                getValue('budgetInnovationOther', 0)) +
                               (getValue('budgetERGMember', 7) + getValue('budgetERGLeader', 0) + getValue('budgetERGOffsite', 0) +
                                getValue('budgetEXCouncil', 0) + getValue('budgetCultureMember', 0) + getValue('budgetCultureChair', 0) +
                                getValue('budgetWellbeing', 7) + getValue('budgetConnectivity', 8) + getValue('budgetCultureOther', 0)) +
                               getValue('budgetVolunteer', 8) +
                               (getValue('budgetExternalConf', 8) + getValue('budgetExternalTraining', 9) + 
                                getValue('budgetOptionalDevOther', 0)) +
                               (getValue('budgetTeamMeetings', 26) + getValue('budgetTownHalls', 1) + 
                                getValue('budgetCheckins', 16) + getValue('budgetBusinessOffsites', 0) + 
                                getValue('budgetProposals', 0) + getValue('budgetBusinessOther', 0));
            
            var grandTotal = essentialTotal + strategicTotal;
            
            // Update summary displays
            setText('totalEssentialAllocated', essentialTotal + ' hours');
            setText('totalStrategicAllocated', strategicTotal + ' hours');
            setText('grandTotalAllocated', grandTotal + ' hours');
            
            // Calculate budget status
            var availableHours = getValue('totalHours', 2080) - 
                               Math.round(getValue('totalHours', 2080) * (getValue('utilization', 80) / 100));
            var difference = grandTotal - availableHours;
            
            var statusElement = document.getElementById('budgetStatus');
            var alertElement = document.getElementById('budgetAlert');
            
            if (statusElement && alertElement) {
                if (difference > 0) {
                    setText('budgetStatus', 'Over by ' + difference + ' hours');
                    statusElement.style.color = 'red';
                    alertElement.style.display = 'block';
                } else {
                    setText('budgetStatus', 'Within range');
                    statusElement.style.color = 'green';
                    alertElement.style.display = 'none';
                }
            }
        }

        // CPM Export Functions
        function exportToCPM() {
            try {
                var empName = getText('employeeName') || 'Employee';
                
                // Calculate totals for CPM categories
                var billableHours = Math.round(getValue('totalHours', 2080) * (getValue('utilization', 80) / 100));
                var boldStepHours = getValue('innovation', 19); // Strategy / Innovation
                var ptoHours = getValue('pto', 120); // PTO only, not holidays
                
                // All other indirect = everything else
                var allOtherIndirect = 64 + getValue('travel', 20) + 
                                     getValue('businessTraining', 13) + getValue('techTraining', 30) + 
                                     getValue('hiring', 20) + getValue('admin', 30) + 
                                     getValue('culture', 22) + getValue('volunteer', 8) + 
                                     getValue('optionalDev', 17) + getValue('businessActivities', 43);
                
                // Create CPM format data with corrected percentages
                var cpmData = [];
                
                // Header row
                var headerRow = ['Accounts by Time'];
                for (var i = 0; i < months2026.length; i++) {
                    headerRow.push(months2026[i].name);
                }
                headerRow.push('FY2026');
                cpmData.push(headerRow);
                
                // Add required CPM structure rows
                cpmData.push(['Headcount']);
                cpmData.push(['Total Direct Hours']);
                cpmData.push(['Partial Headcount']);
                cpmData.push(['Hour Type']);
                cpmData.push(['  Direct Hours']);
                
                // Direct Override row (billable hours)
                var directOverrideRow = ['  Direct Override'];
                var billableTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(billableHours * (months2026[i].percentage / 100));
                    directOverrideRow.push(monthlyHours);
                    billableTotal += monthlyHours;
                }
                directOverrideRow.push(billableTotal);
                cpmData.push(directOverrideRow);
                
                // Bold Step Hours row (Strategy/Innovation)
                var boldStepRow = ['  Bold Step Hours'];
                var boldStepTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(boldStepHours * (months2026[i].percentage / 100));
                    boldStepRow.push(monthlyHours);
                    boldStepTotal += monthlyHours;
                }
                boldStepRow.push(boldStepTotal);
                cpmData.push(boldStepRow);
                
                // PTO Usage row
                cpmData.push(['  PTO Usage']);
                
                // PTO Usage Override row
                var ptoOverrideRow = ['  PTO Usage Override'];
                var ptoTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(ptoHours * (months2026[i].percentage / 100));
                    ptoOverrideRow.push(monthlyHours);
                    ptoTotal += monthlyHours;
                }
                ptoOverrideRow.push(ptoTotal);
                cpmData.push(ptoOverrideRow);
                
                // Company Holiday Hours row
                var holidayHours = 64;
                var holidayRow = ['  Company Holiday Hours'];
                var holidayTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(holidayHours * (months2026[i].percentage / 100));
                    holidayRow.push(monthlyHours);
                    holidayTotal += monthlyHours;
                }
                holidayRow.push(holidayTotal);
                cpmData.push(holidayRow);
                
                // All other Indirect Hours row
                cpmData.push(['  All other Indirect Hours']);
                
                // All other Indirect Override row
                var allOtherRow = ['  All other Indirect Override'];
                var allOtherTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(allOtherIndirect * (months2026[i].percentage / 100));
                    allOtherRow.push(monthlyHours);
                    allOtherTotal += monthlyHours;
                }
                allOtherRow.push(allOtherTotal);
                cpmData.push(allOtherRow);
                
                // Convert to CSV format
                var csvContent = '';
                for (var i = 0; i < cpmData.length; i++) {
                    var row = cpmData[i];
                    var csvRow = '';
                    for (var j = 0; j < row.length; j++) {
                        var cell = row[j];
                        if (typeof cell === 'string' && cell.indexOf(',') !== -1) {
                            csvRow += '"' + cell + '"';
                        } else {
                            csvRow += cell;
                        }
                        if (j < row.length - 1) {
                            csvRow += ',';
                        }
                    }
                    csvContent += csvRow + '\n';
                }
                
                // Create download
                var blob = new Blob([csvContent], { type: 'text/csv' });
                var url = window.URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = empName.replace(/\s+/g, '_') + '_CPM_Budget_2026.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                
                alert('CPM Export Complete!\n\nFile: ' + empName.replace(/\s+/g, '_') + '_CPM_Budget_2026.csv\n\nThis file is ready for direct import into your company CRM system.');
                
            } catch (error) {
                alert('CPM export failed. Please try again or contact support.');
                console.error('CPM Export Error:', error);
            }
        }

        // Budget CPM Export
        function exportBudgetToCPM() {
            try {
                var empName = getText('employeeName') || 'Employee';
                
                // Calculate totals for CPM categories from budget planning
                var billableHours = Math.round(getValue('totalHours', 2080) * (getValue('utilization', 80) / 100));
                
                // Bold Step = Strategy/Innovation from budget
                var boldStepHours = getValue('budgetInnovationProjects', 10) + 
                                   getValue('budgetDigitalTransform', 9) + 
                                   getValue('budgetInnovationOther', 0);
                
                // PTO = PTO categories only
                var ptoHours = getValue('budgetPTO', 120);
                
                // All other indirect = everything else from budget
                var allOtherIndirect = 64 +
                                     (getValue('budgetConferenceTravel', 7) + getValue('budgetTrainingTravel', 7) + 
                                      getValue('budgetClientTravel', 6) + getValue('budgetTeamOffsites', 0) + getValue('budgetTravelOther', 0)) +
                                     (getValue('budgetCompliance', 4) + getValue('budgetLeadership', 5) + 
                                      getValue('budgetPlatform', 4) + getValue('budgetBusinessTrainingOther', 0)) +
                                     (getValue('budgetCertifications', 15) + getValue('budgetUpskilling', 15) + 
                                      getValue('budgetTechTrainingOther', 0)) +
                                     (getValue('budgetRecruiting', 2) + getValue('budgetInterviewing', 6) + 
                                      getValue('budgetOnboarding', 12) + getValue('budgetHiringOther', 0)) +
                                     (getValue('budgetReviews', 12) + getValue('budgetReporting', 12) + 
                                      getValue('budgetSurveys', 6) + getValue('budgetAdminOther', 0)) +
                                     (getValue('budgetERGMember', 7) + getValue('budgetERGLeader', 0) + getValue('budgetERGOffsite', 0) +
                                      getValue('budgetEXCouncil', 0) + getValue('budgetCultureMember', 0) + getValue('budgetCultureChair', 0) +
                                      getValue('budgetWellbeing', 7) + getValue('budgetConnectivity', 8) + getValue('budgetCultureOther', 0)) +
                                     getValue('budgetVolunteer', 8) +
                                     (getValue('budgetExternalConf', 8) + getValue('budgetExternalTraining', 9) + 
                                      getValue('budgetOptionalDevOther', 0)) +
                                     (getValue('budgetTeamMeetings', 26) + getValue('budgetTownHalls', 1) + 
                                      getValue('budgetCheckins', 16) + getValue('budgetBusinessOffsites', 0) + 
                                      getValue('budgetProposals', 0) + getValue('budgetBusinessOther', 0));
                
                // Create CPM format data with corrected calculations
                var cpmData = [];
                
                // Header row
                var headerRow = ['Accounts by Time'];
                for (var i = 0; i < months2026.length; i++) {
                    headerRow.push(months2026[i].name);
                }
                headerRow.push('FY2026');
                cpmData.push(headerRow);
                
                // Standard CPM structure
                cpmData.push(['Headcount']);
                cpmData.push(['Total Direct Hours']);
                cpmData.push(['Partial Headcount']);
                cpmData.push(['Hour Type']);
                cpmData.push(['  Direct Hours']);
                
                // Direct Override row
                var directOverrideRow = ['  Direct Override'];
                var billableTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(billableHours * (months2026[i].percentage / 100));
                    directOverrideRow.push(monthlyHours);
                    billableTotal += monthlyHours;
                }
                directOverrideRow.push(billableTotal);
                cpmData.push(directOverrideRow);
                
                // Bold Step Hours row
                var boldStepRow = ['  Bold Step Hours'];
                var boldStepTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(boldStepHours * (months2026[i].percentage / 100));
                    boldStepRow.push(monthlyHours);
                    boldStepTotal += monthlyHours;
                }
                boldStepRow.push(boldStepTotal);
                cpmData.push(boldStepRow);
                
                cpmData.push(['  PTO Usage']);
                
                // PTO Usage Override row
                var ptoOverrideRow = ['  PTO Usage Override'];
                var ptoTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(ptoHours * (months2026[i].percentage / 100));
                    ptoOverrideRow.push(monthlyHours);
                    ptoTotal += monthlyHours;
                }
                ptoOverrideRow.push(ptoTotal);
                cpmData.push(ptoOverrideRow);
                
                // Company Holiday Hours row
                var holidayHours = 64;
                var holidayRow = ['  Company Holiday Hours'];
                var holidayTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(holidayHours * (months2026[i].percentage / 100));
                    holidayRow.push(monthlyHours);
                    holidayTotal += monthlyHours;
                }
                holidayRow.push(holidayTotal);
                cpmData.push(holidayRow);
                
                cpmData.push(['  All other Indirect Hours']);
                
                // All other Indirect Override row
                var allOtherRow = ['  All other Indirect Override'];
                var allOtherTotal = 0;
                for (var i = 0; i < months2026.length; i++) {
                    var monthlyHours = Math.round(allOtherIndirect * (months2026[i].percentage / 100));
                    allOtherRow.push(monthlyHours);
                    allOtherTotal += monthlyHours;
                }
                allOtherRow.push(allOtherTotal);
                cpmData.push(allOtherRow);
                
                // Convert to CSV
                var csvContent = '';
                for (var i = 0; i < cpmData.length; i++) {
                    var row = cpmData[i];
                    var csvRow = '';
                    for (var j = 0; j < row.length; j++) {
                        var cell = row[j];
                        if (typeof cell === 'string' && cell.indexOf(',') !== -1) {
                            csvRow += '"' + cell + '"';
                        } else {
                            csvRow += cell;
                        }
                        if (j < row.length - 1) {
                            csvRow += ',';
                        }
                    }
                    csvContent += csvRow + '\n';
                }
                
                // Create download
                var blob = new Blob([csvContent], { type: 'text/csv' });
                var url = window.URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = empName.replace(/\s+/g, '_') + '_Budget_CPM_2026.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                
                alert('Budget CPM Export Complete!\n\nFile: ' + empName.replace(/\s+/g, '_') + '_Budget_CPM_2026.csv\n\nDetailed budget breakdown ready for CRM import.');
                
            } catch (error) {
                alert('Budget CPM export failed. Please try again or contact support.');
                console.error('Budget CPM Export Error:', error);
            }
        }

        function printBudgetReport() {
            showTab('budget');
            setTimeout(function() {
                window.print();
            }, 100);
        }

        function resetForm() {
            if (confirm('Clear all data for next employee?')) {
                // Reset employee name
                setValue('employeeName', '');
                
                // Reset employee type to default
                document.getElementById('employeeType').value = 'individual';
                updateEmployeeType();
                
                // Reset LLS to default
                document.getElementById('lls').value = 'power';
                
                // Recalculate with defaults
                calculateAll();
            }
        }

        function resetBudgetForm() {
            if (confirm('Clear budget data for next employee?')) {
                // Reset employee name
                setValue('employeeName', '');
                setText('budgetEmployeeName', 'Enter name in Basic Planning');
                
                // Reset all budget fields to defaults based on current employee type
                syncBasicToBudget();
            }
        }

        // Initialize the application
        function initializeApp() {
            // Set default employee type
            updateEmployeeType();
            
            // Run initial calculations
            calculateAll();
            calculateBudget();
            
            // Set up event listeners for employee name sync
            var employeeNameField = document.getElementById('employeeName');
            if (employeeNameField) {
                employeeNameField.addEventListener('input', function() {
                    if (currentTab === 'budget') {
                        syncBasicToBudget();
                    }
                });
            }
        }

        // Wait for DOM to be ready and initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
